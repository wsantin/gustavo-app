"use strict";(self.webpackChunkpersonal_app=self.webpackChunkpersonal_app||[]).push([[669],{1669:(e,r,a)=>{a.r(r),a.d(r,{default:()=>M});var o=a(5043),s=a(9615),n=a(4858),t=a(8403),c=a(9806),i=a(3969),l=a(172),d=a(2097),u=a(5895),m=a(1449),h=a(1244),p=a(6128),x=a(3089),b=a(6154),g=a(9565),j=a(2579),f=a(4799),y=a(3023),v=a(1911),A=a(8776),E=a(5877),w=a(2950),z=a(8315),q=a(1773),N=a(8209),C=a(4111),L=a(1728),S=a(3264),Z=a(579);const M=function(){var e,r,a,M;const I=(0,s.Zp)(),{id:P}=(0,s.g)(),k=Boolean(P),[Y,G]=(0,o.useState)(!1),[D,O]=(0,o.useState)(k),[H,W]=(0,o.useState)([]),[J,T]=(0,o.useState)(""),[B,R]=(0,o.useState)(""),[U,$]=(0,o.useState)(!1),[_,V]=(0,o.useState)(""),[K,F]=(0,o.useState)(""),[X,Q]=(0,o.useState)(!1),{register:ee,handleSubmit:re,formState:{errors:ae},reset:oe,setValue:se}=(0,n.mN)({resolver:(0,t.t)(C.Hy),defaultValues:{dni:"",nombres:"",apellidos:"",celular:"",zona:""}});(0,o.useEffect)(()=>{ne(),k&&te()},[k,P]);const ne=async()=>{try{const e=await S.A.getZonas();e.success?W(Array.isArray(e.data)?e.data:[]):W([])}catch(J){console.error("Error cargando datos iniciales:",J),T("Error al cargar las zonas"),W([])}},te=async()=>{O(!0);try{const e=await L.A.getSocioById(P);if(e.success){const r=e.data;se("dni",r.dni||""),se("nombres",r.nombres||""),se("apellidos",r.apellidos||""),se("celular",r.celular||""),se("zona",r.zona||"")}else T("No se pudo cargar los datos del personal")}catch(J){console.error("Error al cargar personal:",J),T("Error al cargar los datos del personal")}finally{O(!1)}};return D?(0,Z.jsx)(c.A,{maxWidth:"sm",children:(0,Z.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,Z.jsx)(l.A,{})})}):(0,Z.jsxs)(c.A,{maxWidth:"md",children:[(0,Z.jsxs)(i.A,{sx:{mb:3},children:[(0,Z.jsx)(d.A,{startIcon:(0,Z.jsx)(z.A,{}),onClick:()=>I("/personal"),sx:{mb:2},children:"Volver a la lista"}),(0,Z.jsx)(u.A,{variant:"h4",gutterBottom:!0,children:k?"Editar Personal":"Nuevo Personal"}),(0,Z.jsx)(u.A,{variant:"body1",color:"text.secondary",children:k?"Modifica los datos del personal":"Registra nuevo personal en el sistema"})]}),J&&(0,Z.jsx)(m.A,{severity:"error",sx:{mb:3},onClose:()=>T(""),children:J}),B&&(0,Z.jsx)(m.A,{severity:"success",sx:{mb:3},onClose:()=>R(""),children:B}),(0,Z.jsx)(h.A,{children:(0,Z.jsx)(p.A,{children:(0,Z.jsx)("form",{onSubmit:re(async e=>{G(!0),T(""),R("");try{let r;const a={dni:e.dni.trim(),nombres:e.nombres.trim(),apellidos:e.apellidos.trim(),celular:e.celular.trim(),zona:e.zona,estado:"activo",fechaRegistro:new Date};r=k?await L.A.updateSocio(P,a):await L.A.createSocio(a),r.success?(R(r.message),setTimeout(()=>{I("/personal")},1500)):T(r.error)}catch(J){console.error("Error al guardar personal:",J),T("Error inesperado al guardar los datos del personal")}finally{G(!1)}}),children:(0,Z.jsxs)(x.A,{container:!0,spacing:3,children:[(0,Z.jsx)(x.A,{item:!0,xs:12,md:6,children:(0,Z.jsx)(b.A,{fullWidth:!0,label:"DNI *",placeholder:"Ej: 12345678",...ee("dni"),error:!!ae.dni,helperText:null===(e=ae.dni)||void 0===e?void 0:e.message,inputProps:{maxLength:8}})}),(0,Z.jsx)(x.A,{item:!0,xs:12,md:6,children:(0,Z.jsx)(b.A,{fullWidth:!0,label:"Celular *",placeholder:"Ej: 987654321",...ee("celular"),error:!!ae.celular,helperText:null===(r=ae.celular)||void 0===r?void 0:r.message,inputProps:{maxLength:9}})}),(0,Z.jsx)(x.A,{item:!0,xs:12,md:6,children:(0,Z.jsx)(b.A,{fullWidth:!0,label:"Nombres *",placeholder:"Ej: Juan Carlos",...ee("nombres"),error:!!ae.nombres,helperText:null===(a=ae.nombres)||void 0===a?void 0:a.message})}),(0,Z.jsx)(x.A,{item:!0,xs:12,md:6,children:(0,Z.jsx)(b.A,{fullWidth:!0,label:"Apellidos *",placeholder:"Ej: Garc\xeda L\xf3pez",...ee("apellidos"),error:!!ae.apellidos,helperText:null===(M=ae.apellidos)||void 0===M?void 0:M.message})}),(0,Z.jsx)(x.A,{item:!0,xs:12,children:(0,Z.jsxs)(i.A,{sx:{display:"flex",gap:1,alignItems:"flex-start"},children:[(0,Z.jsx)(g.A,{fullWidth:!0,options:H,getOptionLabel:e=>e.nombre||"",renderOption:(e,r)=>(0,Z.jsx)(i.A,{component:"li",...e,children:(0,Z.jsxs)(i.A,{children:[(0,Z.jsx)(u.A,{variant:"body1",children:r.nombre}),r.descripcion&&(0,Z.jsx)(u.A,{variant:"caption",color:"text.secondary",children:r.descripcion})]})}),renderInput:e=>{var r;return(0,Z.jsx)(b.A,{...e,label:"Zona *",error:!!ae.zona,helperText:null===(r=ae.zona)||void 0===r?void 0:r.message,placeholder:"Buscar zona..."})},onChange:(e,r)=>{se("zona",r?r.nombre:"")},noOptionsText:"No se encontraron zonas",isOptionEqualToValue:(e,r)=>e.nombre===r.nombre}),(0,Z.jsx)(j.A,{color:"primary",onClick:()=>$(!0),sx:{mt:1,bgcolor:"primary.light","&:hover":{bgcolor:"primary.main"},color:"white"},children:(0,Z.jsx)(w.A,{})})]})}),(0,Z.jsx)(x.A,{item:!0,xs:12,children:(0,Z.jsxs)(i.A,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[(0,Z.jsx)(d.A,{variant:"outlined",onClick:()=>I("/personal"),disabled:Y,children:"Cancelar"}),(0,Z.jsx)(d.A,{type:"submit",variant:"contained",disabled:Y,startIcon:Y?(0,Z.jsx)(l.A,{size:20}):k?(0,Z.jsx)(q.A,{}):(0,Z.jsx)(N.A,{}),children:Y?"Guardando...":k?"Actualizar Personal":"Registrar Personal"})]})})]})})})}),(0,Z.jsxs)(f.A,{sx:{p:3,mt:3,bgcolor:"grey.50"},children:[(0,Z.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"\u2139\ufe0f Informaci\xf3n Importante"}),(0,Z.jsxs)(u.A,{variant:"body2",color:"text.secondary",children:["\u2022 El DNI debe tener exactamente 8 d\xedgitos",(0,Z.jsx)("br",{}),"\u2022 El celular debe empezar con 9 y tener 9 d\xedgitos en total",(0,Z.jsx)("br",{}),"\u2022 Los nombres y apellidos solo pueden contener letras y espacios",(0,Z.jsx)("br",{}),"\u2022 Todos los campos marcados con (*) son obligatorios"]})]}),(0,Z.jsxs)(y.A,{open:U,onClose:()=>{$(!1),V(""),F("")},maxWidth:"sm",fullWidth:!0,children:[(0,Z.jsx)(v.A,{children:"Agregar Nueva Zona"}),(0,Z.jsxs)(A.A,{children:[(0,Z.jsx)(b.A,{fullWidth:!0,label:"Nombre de la Zona *",value:_,onChange:e=>V(e.target.value),margin:"normal",placeholder:"Ej: Zona Norte"}),(0,Z.jsx)(b.A,{fullWidth:!0,label:"Descripci\xf3n (opcional)",value:K,onChange:e=>F(e.target.value),margin:"normal",multiline:!0,rows:2,placeholder:"Ej: Comprende los distritos del norte de la ciudad"})]}),(0,Z.jsxs)(E.A,{children:[(0,Z.jsx)(d.A,{onClick:()=>{$(!1),V(""),F("")},disabled:X,children:"Cancelar"}),(0,Z.jsx)(d.A,{onClick:async()=>{if(_.trim()){Q(!0);try{const e={nombre:_.trim(),descripcion:K.trim(),activa:!0},r=await S.A.createZona(e);r.success?(await ne(),se("zona",_.trim()),$(!1),V(""),F(""),R("Nueva zona agregada exitosamente")):T(r.error||"Error al crear la zona")}catch(J){console.error("Error al crear zona:",J),T("Error inesperado al crear la zona")}finally{Q(!1)}}},variant:"contained",disabled:!_.trim()||X,startIcon:X?(0,Z.jsx)(l.A,{size:20}):(0,Z.jsx)(w.A,{}),children:X?"Guardando...":"Agregar Zona"})]})]})]})}},1728:(e,r,a)=>{a.d(r,{A:()=>n});var o=a(6667),s=a(6860);const n=new class{constructor(){this.collectionName="socios"}async createSocio(e){try{const r=s.j.currentUser;if(!r)throw new Error("Usuario no autenticado");const a={...e,estado:e.estado||"activo",fechaRegistro:e.fechaRegistro||(0,o.O5)(),fechaCreacion:(0,o.O5)(),fechaModificacion:(0,o.O5)(),creadoPor:r.uid};return{success:!0,id:(await(0,o.gS)((0,o.rJ)(s.db,this.collectionName),a)).id,message:"Socio creado exitosamente"}}catch(r){return console.error("Error al crear socio:",r),{success:!1,error:this.getErrorMessage(r)}}}async getSocios(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const{pageSize:r=10,lastDoc:a=null,searchTerm:n="",zona:t="",campana:c="",estado:i="",orderField:l="fechaCreacion",orderDirection:d="desc"}=e;let u=(0,o.rJ)(s.db,this.collectionName);const m=[];t&&m.push((0,o._M)("zona","==",t)),c&&m.push((0,o._M)("campana","==",c)),i&&m.push((0,o._M)("estado","==",i)),m.length>0&&(u=(0,o.P)(u,...m)),u=(0,o.P)(u,(0,o.My)(l,d)),a&&(u=(0,o.P)(u,(0,o.HM)(a))),u=(0,o.P)(u,(0,o.AB)(r));const h=await(0,o.GG)(u),p=h.docs.map(e=>({id:e.id,...e.data()}));let x=p;if(n){const e=n.toLowerCase();x=p.filter(r=>(r.nombres||"").toLowerCase().includes(e)||(r.apellidos||"").toLowerCase().includes(e)||(r.celular||"").includes(e))}return{success:!0,data:x,lastDoc:h.docs[h.docs.length-1]||null,hasMore:h.docs.length===r}}catch(r){return console.error("Error al obtener socios:",r),{success:!1,error:this.getErrorMessage(r)}}}async getSocioById(e){try{const r=await(0,o.x7)((0,o.H9)(s.db,this.collectionName,e));return r.exists()?{success:!0,data:{id:r.id,...r.data()}}:{success:!1,error:"Socio no encontrado"}}catch(r){return console.error("Error al obtener socio:",r),{success:!1,error:this.getErrorMessage(r)}}}async updateSocio(e,r){try{const a=s.j.currentUser;if(!a)throw new Error("Usuario no autenticado");const n={...r,fechaModificacion:(0,o.O5)(),modificadoPor:a.uid};return await(0,o.mZ)((0,o.H9)(s.db,this.collectionName,e),n),{success:!0,message:"Socio actualizado exitosamente"}}catch(a){return console.error("Error al actualizar socio:",a),{success:!1,error:this.getErrorMessage(a)}}}async deleteSocio(e){try{if(!s.j.currentUser)throw new Error("Usuario no autenticado");return await(0,o.kd)((0,o.H9)(s.db,this.collectionName,e)),{success:!0,message:"Socio eliminado exitosamente"}}catch(r){return console.error("Error al eliminar socio:",r),{success:!1,error:this.getErrorMessage(r)}}}async getStats(){try{const e=(await(0,o.GG)((0,o.rJ)(s.db,this.collectionName))).docs.map(e=>e.data()),r=e.length,a=e.filter(e=>"activo"===e.estado).length,n=new Date;n.setDate(1),n.setHours(0,0,0,0);const t=e.filter(e=>{var r,a;return((null===(r=e.fechaCreacion)||void 0===r||null===(a=r.toDate)||void 0===a?void 0:a.call(r))||new Date(e.fechaCreacion))>=n}).length,c={};return e.forEach(e=>{e.zona&&(c[e.zona]=(c[e.zona]||0)+1)}),{success:!0,data:{total:r,activos:a,inactivos:r-a,nuevosMes:t,zonaStats:c}}}catch(e){return console.error("Error al obtener estad\xedsticas:",e),{success:!1,error:this.getErrorMessage(e)}}}async bulkDelete(e){try{const r=(0,o.wP)(s.db);return e.forEach(e=>{const a=(0,o.H9)(s.db,this.collectionName,e);r.delete(a)}),await r.commit(),{success:!0,message:`${e.length} socios eliminados exitosamente`}}catch(r){return console.error("Error en eliminaci\xf3n masiva:",r),{success:!1,error:this.getErrorMessage(r)}}}async updateEstado(e,r){return this.updateSocio(e,{estado:r})}getErrorMessage(e){const r={"permission-denied":"No tienes permisos para realizar esta operaci\xf3n","not-found":"El socio no fue encontrado",unavailable:"Servicio no disponible. Por favor, intenta m\xe1s tarde","failed-precondition":"Error en la operaci\xf3n. Verifica los datos","invalid-argument":"Datos inv\xe1lidos proporcionados"};return e.code&&r[e.code]?r[e.code]:e.message||"Ha ocurrido un error inesperado"}}},3264:(e,r,a)=>{a.d(r,{A:()=>n});var o=a(6667),s=a(6860);const n=new class{constructor(){this.collectionName="zonas"}async createZona(e){try{const r=s.j.currentUser;if(!r)throw new Error("Usuario no autenticado");const a={...e,activa:void 0===e.activa||e.activa,fechaCreacion:(0,o.O5)(),fechaModificacion:(0,o.O5)(),creadoPor:r.uid},n=await(0,o.gS)((0,o.rJ)(s.db,this.collectionName),a);return{success:!0,id:n.id,data:{id:n.id,...a},message:"Zona creada exitosamente"}}catch(r){return{success:!1,error:r.message||"Error al crear zona"}}}async getZonas(){try{const e=(0,o.P)((0,o.rJ)(s.db,this.collectionName),(0,o.My)("nombre","asc")),r=await(0,o.GG)(e);return{success:!0,data:r.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas"}}}async getZonasActivas(){try{const e=(0,o.P)((0,o.rJ)(s.db,this.collectionName),(0,o._M)("activa","==",!0),(0,o.My)("nombre","asc")),r=await(0,o.GG)(e);return{success:!0,data:r.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas activas"}}}async updateZona(e,r){try{return await(0,o.mZ)((0,o.H9)(s.db,this.collectionName,e),{...r,fechaModificacion:(0,o.O5)()}),{success:!0,message:"Zona actualizada exitosamente"}}catch(a){return{success:!1,error:a.message||"Error al actualizar zona"}}}async getZonaById(e){try{const r=await(0,o.x7)((0,o.H9)(s.db,this.collectionName,e));return r.exists()?{success:!0,data:{id:r.id,...r.data()}}:{success:!1,error:"Zona no encontrada"}}catch(r){return{success:!1,error:r.message||"Error al obtener zona"}}}async deleteZona(e){try{const r=await(0,o.x7)((0,o.H9)(s.db,this.collectionName,e));if(!r.exists())return{success:!1,error:"Zona no encontrada"};const a=r.data().nombre,n=await(0,o.GG)((0,o.P)((0,o.rJ)(s.db,"socios"),(0,o._M)("zona","==",a)));return n.empty?(await(0,o.kd)((0,o.H9)(s.db,this.collectionName,e)),{success:!0,message:"Zona eliminada exitosamente"}):{success:!1,error:`No se puede eliminar la zona "${a}" porque tiene ${n.size} socio(s) asociado(s)`}}catch(r){return{success:!1,error:r.message||"Error al eliminar zona"}}}async getStats(){try{const e=await(0,o.GG)((0,o.rJ)(s.db,this.collectionName)),r=await(0,o.GG)((0,o.rJ)(s.db,"socios")),a=e.docs.map(e=>({id:e.id,...e.data()})),n=r.docs.map(e=>e.data()),t=a.length,c=a.filter(e=>e.activa).length,i={};return n.forEach(e=>{e.zona&&(i[e.zona]=(i[e.zona]||0)+1)}),{success:!0,data:{total:t,activas:c,inactivas:t-c,sociosPorZona:i}}}catch(e){return{success:!1,error:e.message||"Error al obtener estad\xedsticas"}}}}},4111:(e,r,a)=>{a.d(r,{Hy:()=>n,OI:()=>t,X5:()=>s});var o=a(899);const s=o.Ik({email:o.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido"),password:o.Yj().min(6,"La contrase\xf1a debe tener al menos 6 caracteres").required("La contrase\xf1a es requerida")}),n=(o.Ik({displayName:o.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(50,"El nombre no puede tener m\xe1s de 50 caracteres").required("El nombre es requerido"),email:o.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido"),password:o.Yj().min(6,"La contrase\xf1a debe tener al menos 6 caracteres").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"La contrase\xf1a debe contener al menos una may\xfascula, una min\xfascula y un n\xfamero").required("La contrase\xf1a es requerida"),confirmPassword:o.Yj().oneOf([o.KR("password"),null],"Las contrase\xf1as no coinciden").required("Confirme su contrase\xf1a")}),o.Ik({email:o.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido")}),o.Ik({currentPassword:o.Yj().required("La contrase\xf1a actual es requerida"),newPassword:o.Yj().min(6,"La nueva contrase\xf1a debe tener al menos 6 caracteres").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"La contrase\xf1a debe contener al menos una may\xfascula, una min\xfascula y un n\xfamero").required("La nueva contrase\xf1a es requerida"),confirmNewPassword:o.Yj().oneOf([o.KR("newPassword"),null],"Las contrase\xf1as no coinciden").required("Confirme su nueva contrase\xf1a")}),o.Ik({dni:o.Yj().matches(/^\d{8}$/,"El DNI debe tener exactamente 8 d\xedgitos").required("El DNI es requerido"),nombres:o.Yj().min(2,"Los nombres deben tener al menos 2 caracteres").max(50,"Los nombres no pueden tener m\xe1s de 50 caracteres").matches(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/,"Los nombres solo pueden contener letras").required("Los nombres son requeridos"),apellidos:o.Yj().min(2,"Los apellidos deben tener al menos 2 caracteres").max(50,"Los apellidos no pueden tener m\xe1s de 50 caracteres").matches(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/,"Los apellidos solo pueden contener letras").required("Los apellidos son requeridos"),celular:o.Yj().matches(/^9\d{8}$/,"El celular debe empezar con 9 y tener 9 d\xedgitos").required("El celular es requerido"),zona:o.Yj().required("La zona es requerida")})),t=o.Ik({nombre:o.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(50,"El nombre no puede tener m\xe1s de 50 caracteres").required("El nombre es requerido"),descripcion:o.Yj().max(200,"La descripci\xf3n no puede tener m\xe1s de 200 caracteres").optional()});o.Ik({nombre:o.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(100,"El nombre no puede tener m\xe1s de 100 caracteres").required("El nombre es requerido"),descripcion:o.Yj().max(500,"La descripci\xf3n no puede tener m\xe1s de 500 caracteres").optional(),fechaInicio:o.p6().required("La fecha de inicio es requerida"),fechaFin:o.p6().min(o.KR("fechaInicio"),"La fecha de fin debe ser posterior a la de inicio").required("La fecha de fin es requerida"),activa:o.zM().required("El estado es requerido")})}}]);
//# sourceMappingURL=669.6df4e228.chunk.js.map