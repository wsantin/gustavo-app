"use strict";(self.webpackChunkpersonal_app=self.webpackChunkpersonal_app||[]).push([[248],{1244:(e,r,a)=>{a.d(r,{A:()=>h});var s=a(5043),n=a(8387),o=a(1807),c=a(8128),i=a(8301),t=a(4799),l=a(9857),d=a(6061);function m(e){return(0,d.Ay)("MuiCard",e)}(0,l.A)("MuiCard",["root"]);var u=a(579);const x=(0,c.Ay)(t.A,{name:"MuiCard",slot:"Root"})({overflow:"hidden"}),h=s.forwardRef(function(e,r){const a=(0,i.b)({props:e,name:"MuiCard"}),{className:s,raised:c=!1,...t}=a,l={...a,raised:c},d=(e=>{const{classes:r}=e;return(0,o.A)({root:["root"]},m,r)})(l);return(0,u.jsx)(x,{className:(0,n.A)(d.root,s),elevation:c?8:void 0,ref:r,ownerState:l,...t})})},3264:(e,r,a)=>{a.d(r,{A:()=>o});var s=a(6667),n=a(6860);const o=new class{constructor(){this.collectionName="zonas"}async createZona(e){try{const r=n.j2.currentUser;if(!r)throw new Error("Usuario no autenticado");const a={...e,activa:void 0===e.activa||e.activa,fechaCreacion:(0,s.O5)(),fechaModificacion:(0,s.O5)(),creadoPor:r.uid},o=await(0,s.gS)((0,s.rJ)(n.db,this.collectionName),a);return{success:!0,id:o.id,data:{id:o.id,...a},message:"Zona creada exitosamente"}}catch(r){return{success:!1,error:r.message||"Error al crear zona"}}}async getZonas(){try{const e=(0,s.P)((0,s.rJ)(n.db,this.collectionName),(0,s.My)("nombre","asc")),r=await(0,s.GG)(e);return{success:!0,data:r.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas"}}}async getZonasActivas(){try{const e=(0,s.P)((0,s.rJ)(n.db,this.collectionName),(0,s._M)("activa","==",!0),(0,s.My)("nombre","asc")),r=await(0,s.GG)(e);return{success:!0,data:r.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas activas"}}}async updateZona(e,r){try{return await(0,s.mZ)((0,s.H9)(n.db,this.collectionName,e),{...r,fechaModificacion:(0,s.O5)()}),{success:!0,message:"Zona actualizada exitosamente"}}catch(a){return{success:!1,error:a.message||"Error al actualizar zona"}}}async getZonaById(e){try{const r=await(0,s.x7)((0,s.H9)(n.db,this.collectionName,e));return r.exists()?{success:!0,data:{id:r.id,...r.data()}}:{success:!1,error:"Zona no encontrada"}}catch(r){return{success:!1,error:r.message||"Error al obtener zona"}}}async deleteZona(e){try{const r=await(0,s.x7)((0,s.H9)(n.db,this.collectionName,e));if(!r.exists())return{success:!1,error:"Zona no encontrada"};const a=r.data().nombre,o=await(0,s.GG)((0,s.P)((0,s.rJ)(n.db,"personal"),(0,s._M)("zona","==",a)));return o.empty?(await(0,s.kd)((0,s.H9)(n.db,this.collectionName,e)),{success:!0,message:"Zona eliminada exitosamente"}):{success:!1,error:`No se puede eliminar la zona "${a}" porque tiene ${o.size} personal(es) asociado(s)`}}catch(r){return{success:!1,error:r.message||"Error al eliminar zona"}}}async getStats(){try{const e=await(0,s.GG)((0,s.rJ)(n.db,this.collectionName)),r=await(0,s.GG)((0,s.rJ)(n.db,"Personal")),a=e.docs.map(e=>({id:e.id,...e.data()})),o=r.docs.map(e=>e.data()),c=a.length,i=a.filter(e=>e.activa).length,t={};return o.forEach(e=>{e.zona&&(t[e.zona]=(t[e.zona]||0)+1)}),{success:!0,data:{total:c,activas:i,inactivas:c-i,personalPorZona:t}}}catch(e){return{success:!1,error:e.message||"Error al obtener estad\xedsticas"}}}}},4111:(e,r,a)=>{a.d(r,{Hy:()=>o,OI:()=>c,X5:()=>n});var s=a(899);const n=s.Ik({email:s.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido"),password:s.Yj().min(6,"La contrase\xf1a debe tener al menos 6 caracteres").required("La contrase\xf1a es requerida")}),o=(s.Ik({displayName:s.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(50,"El nombre no puede tener m\xe1s de 50 caracteres").required("El nombre es requerido"),email:s.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido"),password:s.Yj().min(6,"La contrase\xf1a debe tener al menos 6 caracteres").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"La contrase\xf1a debe contener al menos una may\xfascula, una min\xfascula y un n\xfamero").required("La contrase\xf1a es requerida"),confirmPassword:s.Yj().oneOf([s.KR("password"),null],"Las contrase\xf1as no coinciden").required("Confirme su contrase\xf1a")}),s.Ik({email:s.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido")}),s.Ik({currentPassword:s.Yj().required("La contrase\xf1a actual es requerida"),newPassword:s.Yj().min(6,"La nueva contrase\xf1a debe tener al menos 6 caracteres").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"La contrase\xf1a debe contener al menos una may\xfascula, una min\xfascula y un n\xfamero").required("La nueva contrase\xf1a es requerida"),confirmNewPassword:s.Yj().oneOf([s.KR("newPassword"),null],"Las contrase\xf1as no coinciden").required("Confirme su nueva contrase\xf1a")}),s.Ik({dni:s.Yj().matches(/^\d{8}$/,"El DNI debe tener exactamente 8 d\xedgitos").required("El DNI es requerido"),nombres:s.Yj().min(2,"Los nombres deben tener al menos 2 caracteres").max(50,"Los nombres no pueden tener m\xe1s de 50 caracteres").matches(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/,"Los nombres solo pueden contener letras").required("Los nombres son requeridos"),apellidos:s.Yj().min(2,"Los apellidos deben tener al menos 2 caracteres").max(50,"Los apellidos no pueden tener m\xe1s de 50 caracteres").matches(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/,"Los apellidos solo pueden contener letras").required("Los apellidos son requeridos"),celular:s.Yj().matches(/^9\d{8}$/,"El celular debe empezar con 9 y tener 9 d\xedgitos").required("El celular es requerido"),zona:s.Yj().required("La zona es requerida"),direccion:s.Yj().min(5,"La direcci\xf3n debe tener al menos 5 caracteres").max(100,"La direcci\xf3n no puede tener m\xe1s de 100 caracteres").required("La direcci\xf3n es requerida"),fechaJuramentacion:s.p6().max(new Date,"La fecha de juramentaci\xf3n no puede ser futura").required("La fecha de juramentaci\xf3n es requerida")})),c=s.Ik({nombre:s.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(50,"El nombre no puede tener m\xe1s de 50 caracteres").required("El nombre es requerido"),descripcion:s.Yj().max(200,"La descripci\xf3n no puede tener m\xe1s de 200 caracteres").optional()});s.Ik({nombre:s.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(100,"El nombre no puede tener m\xe1s de 100 caracteres").required("El nombre es requerido"),descripcion:s.Yj().max(500,"La descripci\xf3n no puede tener m\xe1s de 500 caracteres").optional(),fechaInicio:s.p6().required("La fecha de inicio es requerida"),fechaFin:s.p6().min(s.KR("fechaInicio"),"La fecha de fin debe ser posterior a la de inicio").required("La fecha de fin es requerida"),activa:s.zM().required("El estado es requerido")})},6128:(e,r,a)=>{a.d(r,{A:()=>x});var s=a(5043),n=a(8387),o=a(1807),c=a(8128),i=a(8301),t=a(9857),l=a(6061);function d(e){return(0,l.Ay)("MuiCardContent",e)}(0,t.A)("MuiCardContent",["root"]);var m=a(579);const u=(0,c.Ay)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}}),x=s.forwardRef(function(e,r){const a=(0,i.b)({props:e,name:"MuiCardContent"}),{className:s,component:c="div",...t}=a,l={...a,component:c},x=(e=>{const{classes:r}=e;return(0,o.A)({root:["root"]},d,r)})(l);return(0,m.jsx)(u,{as:c,className:(0,n.A)(x.root,s),ownerState:l,ref:r,...t})})},9248:(e,r,a)=>{a.r(r),a.d(r,{default:()=>H});var s=a(5043),n=a(8517),o=a(1911),c=a(3969),i=a(8776),t=a(3089),l=a(4343),d=a(5895),m=a(2097),u=a(5877),x=a(9806),h=a(1449),j=a(1244),A=a(6128),p=a(4799),v=a(8259),b=a(7443),f=a(756),y=a(6172),g=a(1341),C=a(4375),q=a(172),z=a(3759),E=a(6529),w=a(2579),L=a(9992),Z=a(579);const I=(0,L.A)((0,Z.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn"),N=(0,L.A)((0,Z.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2z"}),"Assessment"),S=(0,L.A)((0,Z.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"People");var k=a(3745),P=a(2950),Y=a(1773),M=a(5362),G=a(4858),D=a(8403),O=a(4111),B=a(3264);const H=function(){var e;const[r,a]=(0,s.useState)([]),[L,H]=(0,s.useState)(null),[J,R]=(0,s.useState)(!0),[W,$]=(0,s.useState)(""),[V,T]=(0,s.useState)(""),[_,F]=(0,s.useState)(""),[K,U]=(0,s.useState)(!1),[X,Q]=(0,s.useState)(!1),[ee,re]=(0,s.useState)(!1),[ae,se]=(0,s.useState)(null),[ne,oe]=(0,s.useState)({nombre:"",descripcion:"",activa:!0}),{register:ce,handleSubmit:ie,formState:{errors:te},reset:le,setValue:de}=(0,G.mN)({resolver:(0,D.t)(O.OI)});(0,s.useEffect)(()=>{me()},[]);const me=async()=>{R(!0);try{const[e,r]=await Promise.all([B.A.getZonas(),B.A.getStats()]);e.success?a(e.data):$(e.error),r.success&&H(r.data)}catch(W){$("Error al cargar datos")}finally{R(!1)}},ue=async e=>{try{let r;if(r=ae?await B.A.updateZona(ae.id,e):await B.A.createZona(e),r.success){T(r.message);const e={nombre:"",descripcion:"",activa:!0};oe(e),le(e),se(null),U(!1),Q(!1),setTimeout(()=>me(),100)}else $(r.error)}catch(W){$("Error inesperado")}},xe=r.filter(e=>{if(!_)return!0;const r=_.toLowerCase();return e.nombre.toLowerCase().includes(r)||(e.descripcion||"").toLowerCase().includes(r)}),he=e=>{if(!e)return"-";try{return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("es-ES")}catch{return"-"}},je=e=>{var r,a;let{open:s,onClose:x,title:h,isEdit:j=!1}=e;return(0,Z.jsxs)(n.A,{open:s,onClose:x,maxWidth:"sm",fullWidth:!0,children:[(0,Z.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Z.jsx)(I,{color:"primary"}),h]}),(0,Z.jsxs)(c.A,{component:"form",onSubmit:ie(ue),children:[(0,Z.jsx)(i.A,{children:(0,Z.jsxs)(t.A,{container:!0,spacing:3,children:[(0,Z.jsx)(t.A,{item:!0,xs:12,children:(0,Z.jsx)(l.A,{autoFocus:!0,fullWidth:!0,label:"Nombre de la zona",...ce("nombre"),error:!!te.nombre,helperText:null===(r=te.nombre)||void 0===r?void 0:r.message,placeholder:"Ej: Zona Norte, Centro, etc."})}),(0,Z.jsx)(t.A,{item:!0,xs:12,children:(0,Z.jsx)(l.A,{fullWidth:!0,label:"Descripci\xf3n (opcional)",multiline:!0,rows:3,...ce("descripcion"),error:!!te.descripcion,helperText:null===(a=te.descripcion)||void 0===a?void 0:a.message,placeholder:"Descripci\xf3n detallada de la zona..."})}),(0,Z.jsx)(t.A,{item:!0,xs:12,children:(0,Z.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,Z.jsx)(d.A,{variant:"body1",children:"Estado:"}),(0,Z.jsx)(m.A,{variant:!0===ne.activa?"contained":"outlined",color:"success",onClick:()=>{oe(e=>({...e,activa:!0})),de("activa",!0)},size:"small",children:"Activa"}),(0,Z.jsx)(m.A,{variant:!1===ne.activa?"contained":"outlined",color:"error",onClick:()=>{oe(e=>({...e,activa:!1})),de("activa",!1)},size:"small",children:"Inactiva"})]})})]})}),(0,Z.jsxs)(u.A,{children:[(0,Z.jsx)(m.A,{onClick:x,children:"Cancelar"}),(0,Z.jsxs)(m.A,{type:"submit",variant:"contained",children:[j?"Actualizar":"Crear"," Zona"]})]})]})]})};return(0,Z.jsxs)(x.A,{maxWidth:"xl",children:[(0,Z.jsxs)(c.A,{sx:{mb:3},children:[(0,Z.jsxs)(d.A,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Z.jsx)(I,{}),"Gesti\xf3n de Zonas"]}),(0,Z.jsx)(d.A,{variant:"body1",color:"text.secondary",children:"Administra las zonas geogr\xe1ficas del sistema"})]}),W&&(0,Z.jsx)(h.A,{severity:"error",sx:{mb:3},onClose:()=>$(""),children:W}),V&&(0,Z.jsx)(h.A,{severity:"success",sx:{mb:3},onClose:()=>T(""),children:V}),L&&(0,Z.jsxs)(t.A,{container:!0,spacing:3,sx:{mb:3},children:[(0,Z.jsx)(t.A,{item:!0,xs:12,sm:6,md:3,children:(0,Z.jsx)(j.A,{children:(0,Z.jsx)(A.A,{children:(0,Z.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Z.jsx)(N,{color:"primary"}),(0,Z.jsxs)(c.A,{children:[(0,Z.jsx)(d.A,{color:"text.secondary",gutterBottom:!0,children:"Total Zonas"}),(0,Z.jsx)(d.A,{variant:"h4",children:L.total})]})]})})})}),(0,Z.jsx)(t.A,{item:!0,xs:12,sm:6,md:3,children:(0,Z.jsx)(j.A,{children:(0,Z.jsx)(A.A,{children:(0,Z.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Z.jsx)(I,{color:"success"}),(0,Z.jsxs)(c.A,{children:[(0,Z.jsx)(d.A,{color:"text.secondary",gutterBottom:!0,children:"Activas"}),(0,Z.jsx)(d.A,{variant:"h4",color:"success.main",children:L.activas})]})]})})})}),(0,Z.jsx)(t.A,{item:!0,xs:12,sm:6,md:3,children:(0,Z.jsx)(j.A,{children:(0,Z.jsx)(A.A,{children:(0,Z.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Z.jsx)(I,{color:"error"}),(0,Z.jsxs)(c.A,{children:[(0,Z.jsx)(d.A,{color:"text.secondary",gutterBottom:!0,children:"Inactivas"}),(0,Z.jsx)(d.A,{variant:"h4",color:"error.main",children:L.inactivas})]})]})})})}),(0,Z.jsx)(t.A,{item:!0,xs:12,sm:6,md:3,children:(0,Z.jsx)(j.A,{children:(0,Z.jsx)(A.A,{children:(0,Z.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Z.jsx)(S,{color:"info"}),(0,Z.jsxs)(c.A,{children:[(0,Z.jsx)(d.A,{color:"text.secondary",gutterBottom:!0,children:"Con Personal"}),(0,Z.jsx)(d.A,{variant:"h4",color:"info.main",children:Object.keys(L.personalPorZona).length})]})]})})})})]}),(0,Z.jsx)(p.A,{sx:{p:3,mb:3},children:(0,Z.jsxs)(t.A,{container:!0,spacing:2,alignItems:"center",children:[(0,Z.jsx)(t.A,{item:!0,xs:12,md:6,children:(0,Z.jsx)(l.A,{fullWidth:!0,placeholder:"Buscar zonas...",value:_,onChange:e=>F(e.target.value),InputProps:{startAdornment:(0,Z.jsx)(k.A,{sx:{mr:1,color:"text.secondary"}})}})}),(0,Z.jsx)(t.A,{item:!0,xs:12,md:6,children:(0,Z.jsx)(c.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:(0,Z.jsx)(m.A,{variant:"contained",startIcon:(0,Z.jsx)(P.A,{}),onClick:()=>{const e={nombre:"",descripcion:"",activa:!0};oe(e),le(e),se(null),U(!0)},children:"Nueva Zona"})})})]})}),(0,Z.jsx)(p.A,{children:(0,Z.jsx)(v.A,{children:(0,Z.jsxs)(b.A,{children:[(0,Z.jsx)(f.A,{children:(0,Z.jsxs)(y.A,{children:[(0,Z.jsx)(g.A,{children:"Nombre"}),(0,Z.jsx)(g.A,{children:"Descripci\xf3n"}),(0,Z.jsx)(g.A,{children:"Estado"}),(0,Z.jsx)(g.A,{children:"Personal"}),(0,Z.jsx)(g.A,{children:"Fecha Creaci\xf3n"}),(0,Z.jsx)(g.A,{children:"Acciones"})]})}),(0,Z.jsx)(C.A,{children:J?(0,Z.jsx)(y.A,{children:(0,Z.jsx)(g.A,{colSpan:6,align:"center",sx:{py:4},children:(0,Z.jsx)(q.A,{})})}):0===xe.length?(0,Z.jsx)(y.A,{children:(0,Z.jsx)(g.A,{colSpan:6,align:"center",sx:{py:4},children:(0,Z.jsx)(d.A,{color:"text.secondary",children:_?"No se encontraron zonas":"No hay zonas registradas"})})}):xe.map(e=>{var r;return(0,Z.jsxs)(y.A,{children:[(0,Z.jsx)(g.A,{children:(0,Z.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Z.jsx)(I,{color:"primary"}),(0,Z.jsx)(d.A,{variant:"subtitle2",children:e.nombre})]})}),(0,Z.jsx)(g.A,{children:(0,Z.jsx)(d.A,{variant:"body2",color:"text.secondary",children:e.descripcion||"Sin descripci\xf3n"})}),(0,Z.jsx)(g.A,{children:(0,Z.jsx)(z.A,{label:e.activa?"Activa":"Inactiva",color:e.activa?"success":"error",size:"small",variant:"filled"})}),(0,Z.jsx)(g.A,{children:(0,Z.jsx)(z.A,{label:(null===L||void 0===L||null===(r=L.personalPorZona)||void 0===r?void 0:r[e.nombre])||0,color:"info",size:"small",variant:"outlined",icon:(0,Z.jsx)(S,{})})}),(0,Z.jsx)(g.A,{children:he(e.fechaCreacion)}),(0,Z.jsx)(g.A,{children:(0,Z.jsxs)(c.A,{sx:{display:"flex",gap:.5},children:[(0,Z.jsx)(E.A,{title:"Editar zona",children:(0,Z.jsx)(w.A,{size:"small",onClick:()=>(e=>{se(e);const r={nombre:e.nombre,descripcion:e.descripcion||"",activa:e.activa};oe(r),de("nombre",r.nombre),de("descripcion",r.descripcion),de("activa",r.activa),Q(!0)})(e),children:(0,Z.jsx)(Y.A,{})})}),(0,Z.jsx)(E.A,{title:"Eliminar zona",children:(0,Z.jsx)(w.A,{size:"small",color:"error",onClick:()=>(e=>{se(e),re(!0)})(e),children:(0,Z.jsx)(M.A,{})})})]})})]},e.id)})})]})})}),(0,Z.jsx)(je,{open:K,onClose:()=>U(!1),title:"Nueva Zona"}),(0,Z.jsx)(je,{open:X,onClose:()=>Q(!1),title:"Editar Zona",isEdit:!0}),(0,Z.jsxs)(n.A,{open:ee,onClose:()=>re(!1),children:[(0,Z.jsx)(o.A,{children:"Confirmar Eliminaci\xf3n"}),(0,Z.jsxs)(i.A,{children:[(0,Z.jsxs)(d.A,{children:["\xbfEst\xe1s seguro de que deseas eliminar la zona"," ",(0,Z.jsxs)("strong",{children:['"',null===ae||void 0===ae?void 0:ae.nombre,'"']}),"?"]}),(null===L||void 0===L||null===(e=L.personalPorZona)||void 0===e?void 0:e[null===ae||void 0===ae?void 0:ae.nombre])&&(0,Z.jsxs)(h.A,{severity:"warning",sx:{mt:2},children:["Esta zona tiene ",L.personalPorZona[ae.nombre]," persona(s) asociada(s)."]}),(0,Z.jsx)(d.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Esta acci\xf3n no se puede deshacer."})]}),(0,Z.jsxs)(u.A,{children:[(0,Z.jsx)(m.A,{onClick:()=>re(!1),children:"Cancelar"}),(0,Z.jsx)(m.A,{onClick:async()=>{try{const e=await B.A.deleteZona(ae.id);e.success?(T(e.message),re(!1),me()):$(e.error)}catch(W){$("Error al eliminar zona")}},color:"error",variant:"contained",children:"Eliminar"})]})]})]})}}}]);
//# sourceMappingURL=248.012c07c7.chunk.js.map