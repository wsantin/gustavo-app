"use strict";(self.webpackChunkpersonal_app=self.webpackChunkpersonal_app||[]).push([[658],{1728:(e,s,r)=>{r.d(s,{A:()=>t});var a=r(6667),o=r(6860);const t=new class{constructor(){this.collectionName="socios"}async createSocio(e){try{const s=o.j.currentUser;if(!s)throw new Error("Usuario no autenticado");const r={...e,estado:e.estado||"activo",fechaRegistro:e.fechaRegistro||(0,a.O5)(),fechaCreacion:(0,a.O5)(),fechaModificacion:(0,a.O5)(),creadoPor:s.uid};return{success:!0,id:(await(0,a.gS)((0,a.rJ)(o.db,this.collectionName),r)).id,message:"Socio creado exitosamente"}}catch(s){return console.error("Error al crear socio:",s),{success:!1,error:this.getErrorMessage(s)}}}async getSocios(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const{pageSize:s=10,lastDoc:r=null,searchTerm:t="",zona:c="",campana:n="",estado:i="",orderField:l="fechaCreacion",orderDirection:d="desc"}=e;let h=(0,a.rJ)(o.db,this.collectionName);const u=[];c&&u.push((0,a._M)("zona","==",c)),n&&u.push((0,a._M)("campana","==",n)),i&&u.push((0,a._M)("estado","==",i)),u.length>0&&(h=(0,a.P)(h,...u)),h=(0,a.P)(h,(0,a.My)(l,d)),r&&(h=(0,a.P)(h,(0,a.HM)(r))),h=(0,a.P)(h,(0,a.AB)(s));const m=await(0,a.GG)(h),x=m.docs.map(e=>({id:e.id,...e.data()}));let g=x;if(t){const e=t.toLowerCase();g=x.filter(s=>(s.nombres||"").toLowerCase().includes(e)||(s.apellidos||"").toLowerCase().includes(e)||(s.celular||"").includes(e))}return{success:!0,data:g,lastDoc:m.docs[m.docs.length-1]||null,hasMore:m.docs.length===s}}catch(s){return console.error("Error al obtener socios:",s),{success:!1,error:this.getErrorMessage(s)}}}async getSocioById(e){try{const s=await(0,a.x7)((0,a.H9)(o.db,this.collectionName,e));return s.exists()?{success:!0,data:{id:s.id,...s.data()}}:{success:!1,error:"Socio no encontrado"}}catch(s){return console.error("Error al obtener socio:",s),{success:!1,error:this.getErrorMessage(s)}}}async updateSocio(e,s){try{const r=o.j.currentUser;if(!r)throw new Error("Usuario no autenticado");const t={...s,fechaModificacion:(0,a.O5)(),modificadoPor:r.uid};return await(0,a.mZ)((0,a.H9)(o.db,this.collectionName,e),t),{success:!0,message:"Socio actualizado exitosamente"}}catch(r){return console.error("Error al actualizar socio:",r),{success:!1,error:this.getErrorMessage(r)}}}async deleteSocio(e){try{if(!o.j.currentUser)throw new Error("Usuario no autenticado");return await(0,a.kd)((0,a.H9)(o.db,this.collectionName,e)),{success:!0,message:"Socio eliminado exitosamente"}}catch(s){return console.error("Error al eliminar socio:",s),{success:!1,error:this.getErrorMessage(s)}}}async getStats(){try{const e=(await(0,a.GG)((0,a.rJ)(o.db,this.collectionName))).docs.map(e=>e.data()),s=e.length,r=e.filter(e=>"activo"===e.estado).length,t=new Date;t.setDate(1),t.setHours(0,0,0,0);const c=e.filter(e=>{var s,r;return((null===(s=e.fechaCreacion)||void 0===s||null===(r=s.toDate)||void 0===r?void 0:r.call(s))||new Date(e.fechaCreacion))>=t}).length,n={};return e.forEach(e=>{e.zona&&(n[e.zona]=(n[e.zona]||0)+1)}),{success:!0,data:{total:s,activos:r,inactivos:s-r,nuevosMes:c,zonaStats:n}}}catch(e){return console.error("Error al obtener estad\xedsticas:",e),{success:!1,error:this.getErrorMessage(e)}}}async bulkDelete(e){try{const s=(0,a.wP)(o.db);return e.forEach(e=>{const r=(0,a.H9)(o.db,this.collectionName,e);s.delete(r)}),await s.commit(),{success:!0,message:`${e.length} socios eliminados exitosamente`}}catch(s){return console.error("Error en eliminaci\xf3n masiva:",s),{success:!1,error:this.getErrorMessage(s)}}}async updateEstado(e,s){return this.updateSocio(e,{estado:s})}getErrorMessage(e){const s={"permission-denied":"No tienes permisos para realizar esta operaci\xf3n","not-found":"El socio no fue encontrado",unavailable:"Servicio no disponible. Por favor, intenta m\xe1s tarde","failed-precondition":"Error en la operaci\xf3n. Verifica los datos","invalid-argument":"Datos inv\xe1lidos proporcionados"};return e.code&&s[e.code]?s[e.code]:e.message||"Ha ocurrido un error inesperado"}}},3264:(e,s,r)=>{r.d(s,{A:()=>t});var a=r(6667),o=r(6860);const t=new class{constructor(){this.collectionName="zonas"}async createZona(e){try{const s=o.j.currentUser;if(!s)throw new Error("Usuario no autenticado");const r={...e,activa:void 0===e.activa||e.activa,fechaCreacion:(0,a.O5)(),fechaModificacion:(0,a.O5)(),creadoPor:s.uid},t=await(0,a.gS)((0,a.rJ)(o.db,this.collectionName),r);return{success:!0,id:t.id,data:{id:t.id,...r},message:"Zona creada exitosamente"}}catch(s){return{success:!1,error:s.message||"Error al crear zona"}}}async getZonas(){try{const e=(0,a.P)((0,a.rJ)(o.db,this.collectionName),(0,a.My)("nombre","asc")),s=await(0,a.GG)(e);return{success:!0,data:s.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas"}}}async getZonasActivas(){try{const e=(0,a.P)((0,a.rJ)(o.db,this.collectionName),(0,a._M)("activa","==",!0),(0,a.My)("nombre","asc")),s=await(0,a.GG)(e);return{success:!0,data:s.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas activas"}}}async updateZona(e,s){try{return await(0,a.mZ)((0,a.H9)(o.db,this.collectionName,e),{...s,fechaModificacion:(0,a.O5)()}),{success:!0,message:"Zona actualizada exitosamente"}}catch(r){return{success:!1,error:r.message||"Error al actualizar zona"}}}async getZonaById(e){try{const s=await(0,a.x7)((0,a.H9)(o.db,this.collectionName,e));return s.exists()?{success:!0,data:{id:s.id,...s.data()}}:{success:!1,error:"Zona no encontrada"}}catch(s){return{success:!1,error:s.message||"Error al obtener zona"}}}async deleteZona(e){try{const s=await(0,a.x7)((0,a.H9)(o.db,this.collectionName,e));if(!s.exists())return{success:!1,error:"Zona no encontrada"};const r=s.data().nombre,t=await(0,a.GG)((0,a.P)((0,a.rJ)(o.db,"socios"),(0,a._M)("zona","==",r)));return t.empty?(await(0,a.kd)((0,a.H9)(o.db,this.collectionName,e)),{success:!0,message:"Zona eliminada exitosamente"}):{success:!1,error:`No se puede eliminar la zona "${r}" porque tiene ${t.size} socio(s) asociado(s)`}}catch(s){return{success:!1,error:s.message||"Error al eliminar zona"}}}async getStats(){try{const e=await(0,a.GG)((0,a.rJ)(o.db,this.collectionName)),s=await(0,a.GG)((0,a.rJ)(o.db,"socios")),r=e.docs.map(e=>({id:e.id,...e.data()})),t=s.docs.map(e=>e.data()),c=r.length,n=r.filter(e=>e.activa).length,i={};return t.forEach(e=>{e.zona&&(i[e.zona]=(i[e.zona]||0)+1)}),{success:!0,data:{total:c,activas:n,inactivas:c-n,sociosPorZona:i}}}catch(e){return{success:!1,error:e.message||"Error al obtener estad\xedsticas"}}}}},3658:(e,s,r)=>{r.r(s),r.d(s,{default:()=>R});var a=r(5043),o=r(9806),t=r(3969),c=r(5895),n=r(1449),i=r(4799),l=r(3089),d=r(6154),h=r(256),u=r(9067),m=r(7203),x=r(7471),g=r(2097),p=r(8259),A=r(7443),j=r(756),v=r(6172),b=r(1341),y=r(6711),w=r(1778),f=r(4375),E=r(172),C=r(7873),z=r(3759),S=r(6529),P=r(2579),N=r(3919),k=r(3023),M=r(1911),Z=r(8776),G=r(5877),D=r(2950),H=r(8916),L=r(5362),I=r(1773),O=r(3745),J=r(3665),U=r(9615),$=r(1728),W=r(3264),_=r(579);const R=function(){var e,s;const r=(0,U.Zp)(),[R,B]=(0,a.useState)([]),[F,T]=(0,a.useState)(!0),[q,V]=(0,a.useState)(""),[K,Q]=(0,a.useState)(""),[X,Y]=(0,a.useState)(""),[ee,se]=(0,a.useState)(""),[re,ae]=(0,a.useState)(""),[oe,te]=(0,a.useState)([]),[ce,ne]=(0,a.useState)(0),[ie,le]=(0,a.useState)(10),[de,he]=(0,a.useState)("asc"),[ue,me]=(0,a.useState)("dni"),[xe,ge]=(0,a.useState)({open:!1,socio:null}),[pe,Ae]=(0,a.useState)([]);(0,a.useEffect)(()=>{je()},[]),(0,a.useEffect)(()=>{ve()},[X,ee,re]);const je=async()=>{try{const e=await W.A.getZonas();e.success?te(Array.isArray(e.data)?e.data:[]):(console.error("Error cargando zonas:",e.error),te([]))}catch(q){console.error("Error cargando datos iniciales:",q),te([])}},ve=async()=>{T(!0),V("");try{const e=await $.A.getSocios({searchTerm:X,zona:ee,estado:re});if(e.success){const s=Array.isArray(e.data)?e.data:[];B(s),Ae([])}else V(e.error||"Error al cargar el personal"),B([])}catch(q){console.error("Error al cargar personal:",q),V("Error al cargar el personal"),B([])}finally{T(!1)}},be=(e,s,r)=>s[r]<e[r]?-1:s[r]>e[r]?1:0,ye=R.filter(e=>{var s,r,a,o;const t=!X||(null===(s=e.dni)||void 0===s?void 0:s.toLowerCase().includes(X.toLowerCase()))||(null===(r=e.nombres)||void 0===r?void 0:r.toLowerCase().includes(X.toLowerCase()))||(null===(a=e.apellidos)||void 0===a?void 0:a.toLowerCase().includes(X.toLowerCase()))||(null===(o=e.celular)||void 0===o?void 0:o.toLowerCase().includes(X.toLowerCase())),c=!ee||e.zona===ee,n=!re||e.estado===re;return t&&c&&n}),we=((e,s)=>{const r=e.map((e,s)=>[e,s]);return r.sort((e,r)=>{const a=s(e[0],r[0]);return 0!==a?a:e[1]-r[1]}),r.map(e=>e[0])})(ye,((e,s)=>"desc"===e?(e,r)=>be(e,r,s):(e,r)=>-be(e,r,s))(de,ue)).slice(ce*ie,ce*ie+ie);return(0,_.jsxs)(o.A,{maxWidth:"xl",children:[(0,_.jsxs)(t.A,{sx:{mb:3},children:[(0,_.jsx)(c.A,{variant:"h4",gutterBottom:!0,children:"Lista de Personal"}),(0,_.jsx)(c.A,{variant:"body1",color:"text.secondary",children:"Gestiona todo el personal registrado en el sistema"})]}),q&&(0,_.jsx)(n.A,{severity:"error",sx:{mb:3},onClose:()=>V(""),children:q}),K&&(0,_.jsx)(n.A,{severity:"success",sx:{mb:3},onClose:()=>Q(""),children:K}),(0,_.jsxs)(i.A,{sx:{p:3,mb:3},children:[(0,_.jsxs)(l.A,{container:!0,spacing:2,alignItems:"center",children:[(0,_.jsx)(l.A,{item:!0,xs:12,md:3,children:(0,_.jsx)(d.A,{fullWidth:!0,placeholder:"Buscar personal por DNI, nombre, apellido o celular...",value:X,onChange:e=>Y(e.target.value),InputProps:{startAdornment:(0,_.jsx)(O.A,{sx:{mr:1,color:"text.secondary"}})}})}),(0,_.jsx)(l.A,{item:!0,xs:12,md:2,children:(0,_.jsxs)(h.A,{fullWidth:!0,size:"small",children:[(0,_.jsx)(u.A,{children:"Zona"}),(0,_.jsxs)(m.A,{value:ee,label:"Zona",onChange:e=>se(e.target.value),children:[(0,_.jsx)(x.A,{value:"",children:"Todas"}),oe.map(e=>(0,_.jsx)(x.A,{value:e.nombre,children:e.nombre},e.id))]})]})}),(0,_.jsx)(l.A,{item:!0,xs:12,md:2,children:(0,_.jsxs)(h.A,{fullWidth:!0,size:"small",children:[(0,_.jsx)(u.A,{children:"Estado"}),(0,_.jsxs)(m.A,{value:re,label:"Estado",onChange:e=>ae(e.target.value),children:[(0,_.jsx)(x.A,{value:"",children:"Todos"}),(0,_.jsx)(x.A,{value:"activo",children:"Activo"}),(0,_.jsx)(x.A,{value:"inactivo",children:"Inactivo"})]})]})}),(0,_.jsx)(l.A,{item:!0,xs:12,md:5,children:(0,_.jsxs)(t.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[(0,_.jsx)(g.A,{variant:"outlined",startIcon:(0,_.jsx)(H.A,{}),onClick:()=>{Y(""),se(""),ae("")},children:"Limpiar"}),(0,_.jsx)(g.A,{variant:"contained",startIcon:(0,_.jsx)(D.A,{}),onClick:()=>r("/personal/nuevo"),children:"Nuevo Personal"})]})})]}),pe.length>0&&(0,_.jsxs)(t.A,{sx:{mt:2,p:2,bgcolor:"action.selected",borderRadius:1},children:[(0,_.jsxs)(c.A,{variant:"body2",sx:{mb:1},children:[pe.length," persona(s) seleccionada(s)"]}),(0,_.jsx)(g.A,{variant:"outlined",color:"error",size:"small",startIcon:(0,_.jsx)(L.A,{}),onClick:async()=>{if(0!==pe.length)try{const e=await $.A.bulkDelete(pe);e.success?(Q(e.message),Ae([]),ve()):V(e.error)}catch(q){console.error("Error en eliminaci\xf3n masiva:",q),V("Error en la eliminaci\xf3n masiva")}},children:"Eliminar seleccionados"})]})]}),(0,_.jsxs)(i.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,_.jsx)(p.A,{sx:{maxHeight:440},children:(0,_.jsxs)(A.A,{stickyHeader:!0,children:[(0,_.jsx)(j.A,{children:(0,_.jsxs)(v.A,{children:[(0,_.jsx)(b.A,{padding:"checkbox",children:(0,_.jsx)(y.A,{color:"primary",indeterminate:pe.length>0&&pe.length<R.length,checked:R.length>0&&pe.length===R.length,onChange:e=>{if(e.target.checked){const e=R.map(e=>e.id);return void Ae(e)}Ae([])}})}),(0,_.jsx)(b.A,{width:60,children:"Avatar"}),[{id:"dni",label:"DNI",sortable:!0,width:100},{id:"nombres",label:"Nombres",sortable:!0,width:140},{id:"apellidos",label:"Apellidos",sortable:!0,width:140},{id:"celular",label:"Celular",sortable:!0,width:110},{id:"zona",label:"Zona",sortable:!0,width:150},{id:"acciones",label:"Acciones",sortable:!1,width:150}].map(e=>(0,_.jsx)(b.A,{width:e.width,sortDirection:ue===e.id&&de,children:e.sortable?(0,_.jsx)(w.A,{active:ue===e.id,direction:ue===e.id?de:"asc",onClick:()=>{return s=e.id,he(ue===s&&"asc"===de?"desc":"asc"),void me(s);var s},children:e.label}):e.label},e.id))]})}),(0,_.jsx)(f.A,{children:F?(0,_.jsx)(v.A,{children:(0,_.jsx)(b.A,{colSpan:8,align:"center",children:(0,_.jsx)(E.A,{})})}):0===we.length?(0,_.jsx)(v.A,{children:(0,_.jsx)(b.A,{colSpan:8,align:"center",children:(0,_.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No hay personal registrado"})})}):we.map(e=>{const s=(a=e.id,-1!==pe.indexOf(a));var a,o,n;return(0,_.jsxs)(v.A,{hover:!0,selected:s,children:[(0,_.jsx)(b.A,{padding:"checkbox",children:(0,_.jsx)(y.A,{color:"primary",checked:s,onChange:s=>((e,s)=>{const r=pe.indexOf(s);let a=[];-1===r?a=a.concat(pe,s):0===r?a=a.concat(pe.slice(1)):r===pe.length-1?a=a.concat(pe.slice(0,-1)):r>0&&(a=a.concat(pe.slice(0,r),pe.slice(r+1))),Ae(a)})(0,e.id)})}),(0,_.jsx)(b.A,{children:(0,_.jsx)(C.A,{sx:{width:32,height:32,bgcolor:"primary.main"},children:(o=e.nombres,n=e.apellidos,((o?o.charAt(0):"")+(n?n.charAt(0):"")).toUpperCase())})}),(0,_.jsx)(b.A,{children:(0,_.jsx)(c.A,{variant:"body2",fontFamily:"monospace",fontWeight:"bold",children:e.dni||"-"})}),(0,_.jsx)(b.A,{children:e.nombres||"-"}),(0,_.jsx)(b.A,{children:e.apellidos||"-"}),(0,_.jsx)(b.A,{children:(0,_.jsx)(c.A,{variant:"body2",fontFamily:"monospace",children:e.celular||"-"})}),(0,_.jsx)(b.A,{children:(0,_.jsx)(z.A,{label:e.zona||"Sin zona",size:"small",variant:"outlined",color:"primary"})}),(0,_.jsx)(b.A,{children:(0,_.jsxs)(t.A,{sx:{display:"flex",gap:.5},children:[(0,_.jsx)(S.A,{title:"Ver detalles",children:(0,_.jsx)(P.A,{size:"small",onClick:()=>r(`/personal/ver/${e.id}`),children:(0,_.jsx)(J.A,{})})}),(0,_.jsx)(S.A,{title:"Editar",children:(0,_.jsx)(P.A,{size:"small",onClick:()=>r(`/personal/editar/${e.id}`),children:(0,_.jsx)(I.A,{})})}),(0,_.jsx)(S.A,{title:"Eliminar",children:(0,_.jsx)(P.A,{size:"small",color:"error",onClick:()=>ge({open:!0,socio:e}),children:(0,_.jsx)(L.A,{})})})]})})]},e.id)})})]})}),(0,_.jsx)(N.A,{rowsPerPageOptions:[5,10,25,50],component:"div",count:ye.length,rowsPerPage:ie,page:ce,onPageChange:(e,s)=>{ne(s)},onRowsPerPageChange:e=>{le(parseInt(e.target.value,10)),ne(0)},labelRowsPerPage:"Filas por p\xe1gina:",labelDisplayedRows:e=>{let{from:s,to:r,count:a}=e;return`${s}-${r} de ${-1!==a?a:`m\xe1s de ${r}`}`}})]}),(0,_.jsxs)(k.A,{open:xe.open,onClose:()=>ge({open:!1,socio:null}),maxWidth:"sm",fullWidth:!0,children:[(0,_.jsx)(M.A,{children:"Confirmar Eliminaci\xf3n"}),(0,_.jsxs)(Z.A,{children:[(0,_.jsxs)(c.A,{children:["\xbfEst\xe1s seguro de que deseas eliminar del personal a"," ",(0,_.jsxs)("strong",{children:[null===(e=xe.socio)||void 0===e?void 0:e.nombres," ",null===(s=xe.socio)||void 0===s?void 0:s.apellidos]}),"?"]}),(0,_.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Esta acci\xf3n no se puede deshacer."})]}),(0,_.jsxs)(G.A,{children:[(0,_.jsx)(g.A,{onClick:()=>ge({open:!1,socio:null}),children:"Cancelar"}),(0,_.jsx)(g.A,{onClick:async()=>{try{const e=await $.A.deleteSocio(xe.socio.id);e.success?(Q(e.message),ve(),ge({open:!1,socio:null})):V(e.error)}catch(q){console.error("Error al eliminar personal:",q),V("Error al eliminar el personal")}},color:"error",variant:"contained",children:"Eliminar"})]})]})]})}}}]);
//# sourceMappingURL=658.f9db911e.chunk.js.map