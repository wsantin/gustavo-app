"use strict";(self.webpackChunkpersonal_app=self.webpackChunkpersonal_app||[]).push([[106],{106:(e,a,r)=>{r.r(a),r.d(a,{default:()=>B});var s=r(5043),o=r(9806),n=r(3969),t=r(5895),c=r(1449),i=r(4799),l=r(3089),d=r(4343),h=r(2097),u=r(172),m=r(256),x=r(9067),g=r(7203),p=r(7471),A=r(8259),j=r(7443),b=r(756),v=r(6172),y=r(1341),f=r(6711),w=r(1778),E=r(4375),z=r(7873),C=r(3759),S=r(6529),P=r(2579),k=r(3919),N=r(8517),M=r(1911),Z=r(8776),D=r(5877),G=r(2950),J=r(8916),L=r(5362),H=r(1773),O=r(3745),I=r(3665),U=r(9615),W=r(1236),$=r(3264),F=r(579);const B=function(){var e,a;const r=(0,U.Zp)(),[B,R]=(0,s.useState)([]),[T,_]=(0,s.useState)(!0),[q,V]=(0,s.useState)(""),[K,Q]=(0,s.useState)(""),[X,Y]=(0,s.useState)(""),[ee,ae]=(0,s.useState)(""),[re,se]=(0,s.useState)(""),[oe,ne]=(0,s.useState)([]),[te,ce]=(0,s.useState)(0),[ie,le]=(0,s.useState)(10),[de,he]=(0,s.useState)("asc"),[ue,me]=(0,s.useState)("dni"),[xe,ge]=(0,s.useState)({open:!1,socio:null}),[pe,Ae]=(0,s.useState)([]);(0,s.useEffect)(()=>{be(),ve()},[]);const je=()=>{ve()};(0,s.useEffect)(()=>{ve()},[ee]);const be=async()=>{try{const e=await $.A.getZonas();e.success?ne(Array.isArray(e.data)?e.data:[]):(console.error("Error cargando zonas:",e.error),ne([]))}catch(q){console.error("Error cargando datos iniciales:",q),ne([])}},ve=async()=>{_(!0),V("");try{console.log("\ud83d\udd0d Aplicando filtros:",{searchTerm:X,zona:ee});const e=await W.A.getSocios({searchTerm:X,zona:ee});if(e.success){const a=Array.isArray(e.data)?e.data:[];R(a),Ae([])}else V(e.error||"Error al cargar el personal"),R([])}catch(q){console.error("Error al cargar personal:",q),V("Error al cargar el personal"),R([])}finally{_(!1)}},ye=(e,a,r)=>a[r]<e[r]?-1:a[r]>e[r]?1:0,fe=B.filter(e=>{var a,r,s,o;const n=!X||(null===(a=e.dni)||void 0===a?void 0:a.toLowerCase().includes(X.toLowerCase()))||(null===(r=e.nombres)||void 0===r?void 0:r.toLowerCase().includes(X.toLowerCase()))||(null===(s=e.apellidos)||void 0===s?void 0:s.toLowerCase().includes(X.toLowerCase()))||(null===(o=e.celular)||void 0===o?void 0:o.toLowerCase().includes(X.toLowerCase())),t=!ee||e.zona===ee;return n&&t}),we=((e,a)=>{const r=e.map((e,a)=>[e,a]);return r.sort((e,r)=>{const s=a(e[0],r[0]);return 0!==s?s:e[1]-r[1]}),r.map(e=>e[0])})(fe,((e,a)=>"desc"===e?(e,r)=>ye(e,r,a):(e,r)=>-ye(e,r,a))(de,ue)).slice(te*ie,te*ie+ie);return(0,F.jsxs)(o.A,{maxWidth:"xl",children:[(0,F.jsxs)(n.A,{sx:{mb:3},children:[(0,F.jsx)(t.A,{variant:"h4",gutterBottom:!0,children:"Lista de Personal"}),(0,F.jsx)(t.A,{variant:"body1",color:"text.secondary",children:"Gestiona todo el personal registrado en el sistema"})]}),q&&(0,F.jsx)(c.A,{severity:"error",sx:{mb:3},onClose:()=>V(""),children:q}),K&&(0,F.jsx)(c.A,{severity:"success",sx:{mb:3},onClose:()=>Q(""),children:K}),(0,F.jsxs)(i.A,{sx:{p:3,mb:3},children:[(0,F.jsxs)(l.A,{container:!0,spacing:2,alignItems:"center",children:[(0,F.jsx)(l.A,{item:!0,xs:12,md:3,children:(0,F.jsxs)(n.A,{display:"flex",gap:1,children:[(0,F.jsx)(d.A,{fullWidth:!0,placeholder:"Buscar personal por DNI, nombre, apellido o celular...",value:X,onChange:e=>Y(e.target.value),onKeyPress:e=>{"Enter"===e.key&&je()},InputProps:{startAdornment:(0,F.jsx)(O.A,{sx:{mr:1,color:"text.secondary"}})}}),(0,F.jsx)(h.A,{variant:"outlined",onClick:je,disabled:T,sx:{minWidth:"auto",px:2},children:T?(0,F.jsx)(u.A,{size:20}):(0,F.jsx)(O.A,{})})]})}),(0,F.jsx)(l.A,{item:!0,xs:12,md:2,children:(0,F.jsxs)(m.A,{fullWidth:!0,size:"small",children:[(0,F.jsx)(x.A,{children:"Zona"}),(0,F.jsxs)(g.A,{value:ee,label:"Zona",sx:{minWidth:120},onChange:e=>ae(e.target.value),children:[(0,F.jsx)(p.A,{value:"",children:"Todas"}),oe.map(e=>(0,F.jsx)(p.A,{value:e.nombre,children:e.nombre},e.id))]})]})}),(0,F.jsx)(l.A,{item:!0,xs:12,md:5,children:(0,F.jsxs)(n.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[(0,F.jsx)(h.A,{variant:"outlined",startIcon:(0,F.jsx)(J.A,{}),onClick:()=>{Y(""),ae(""),ve()},children:"Limpiar"}),(0,F.jsx)(h.A,{variant:"contained",startIcon:(0,F.jsx)(G.A,{}),onClick:()=>r("/personal/nuevo"),children:"Nuevo Personal"})]})})]}),pe.length>0&&(0,F.jsxs)(n.A,{sx:{mt:2,p:2,bgcolor:"action.selected",borderRadius:1},children:[(0,F.jsxs)(t.A,{variant:"body2",sx:{mb:1},children:[pe.length," persona(s) seleccionada(s)"]}),(0,F.jsx)(h.A,{variant:"outlined",color:"error",size:"small",startIcon:(0,F.jsx)(L.A,{}),onClick:async()=>{if(0!==pe.length)try{const e=await W.A.bulkDelete(pe);e.success?(Q(e.message),Ae([]),ve()):V(e.error)}catch(q){console.error("Error en eliminaci\xf3n masiva:",q),V("Error en la eliminaci\xf3n masiva")}},children:"Eliminar seleccionados"})]})]}),(0,F.jsxs)(i.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,F.jsx)(A.A,{sx:{maxHeight:440},children:(0,F.jsxs)(j.A,{stickyHeader:!0,children:[(0,F.jsx)(b.A,{children:(0,F.jsxs)(v.A,{children:[(0,F.jsx)(y.A,{padding:"checkbox",children:(0,F.jsx)(f.A,{color:"primary",indeterminate:pe.length>0&&pe.length<B.length,checked:B.length>0&&pe.length===B.length,onChange:e=>{if(e.target.checked){const e=B.map(e=>e.id);return void Ae(e)}Ae([])}})}),(0,F.jsx)(y.A,{width:60,children:"Avatar"}),[{id:"dni",label:"DNI",sortable:!0,width:100},{id:"nombres",label:"Nombres",sortable:!0,width:130},{id:"apellidos",label:"Apellidos",sortable:!0,width:130},{id:"celular",label:"Celular",sortable:!0,width:110},{id:"zona",label:"Zona",sortable:!0,width:120},{id:"direccion",label:"Direcci\xf3n",sortable:!0,width:160},{id:"fechaJuramentacion",label:"Fecha Juramentaci\xf3n",sortable:!0,width:140},{id:"acciones",label:"Acciones",sortable:!1,width:150}].map(e=>(0,F.jsx)(y.A,{width:e.width,sortDirection:ue===e.id&&de,children:e.sortable?(0,F.jsx)(w.A,{active:ue===e.id,direction:ue===e.id?de:"asc",onClick:()=>{return a=e.id,he(ue===a&&"asc"===de?"desc":"asc"),void me(a);var a},children:e.label}):e.label},e.id))]})}),(0,F.jsx)(E.A,{children:T?(0,F.jsx)(v.A,{children:(0,F.jsx)(y.A,{colSpan:10,align:"center",children:(0,F.jsx)(u.A,{})})}):0===we.length?(0,F.jsx)(v.A,{children:(0,F.jsx)(y.A,{colSpan:10,align:"center",children:(0,F.jsx)(t.A,{variant:"body2",color:"text.secondary",children:"No hay personal registrado"})})}):we.map(e=>{const a=(s=e.id,-1!==pe.indexOf(s));var s,o,c;return(0,F.jsxs)(v.A,{hover:!0,selected:a,children:[(0,F.jsx)(y.A,{padding:"checkbox",children:(0,F.jsx)(f.A,{color:"primary",checked:a,onChange:a=>((e,a)=>{const r=pe.indexOf(a);let s=[];-1===r?s=s.concat(pe,a):0===r?s=s.concat(pe.slice(1)):r===pe.length-1?s=s.concat(pe.slice(0,-1)):r>0&&(s=s.concat(pe.slice(0,r),pe.slice(r+1))),Ae(s)})(0,e.id)})}),(0,F.jsx)(y.A,{children:(0,F.jsx)(z.A,{sx:{width:32,height:32,bgcolor:"primary.main"},children:(o=e.nombres,c=e.apellidos,((o?o.charAt(0):"")+(c?c.charAt(0):"")).toUpperCase())})}),(0,F.jsx)(y.A,{children:(0,F.jsx)(t.A,{variant:"body2",fontFamily:"monospace",fontWeight:"bold",children:e.dni||"-"})}),(0,F.jsx)(y.A,{children:e.nombres||"-"}),(0,F.jsx)(y.A,{children:e.apellidos||"-"}),(0,F.jsx)(y.A,{children:(0,F.jsx)(t.A,{variant:"body2",fontFamily:"monospace",children:e.celular||"-"})}),(0,F.jsx)(y.A,{children:(0,F.jsx)(C.A,{label:e.zona||"Sin zona",size:"small",variant:"outlined",color:"primary"})}),(0,F.jsx)(y.A,{children:(0,F.jsx)(t.A,{variant:"body2",sx:{maxWidth:160,overflow:"hidden",textOverflow:"ellipsis"},children:e.direccion||"-"})}),(0,F.jsx)(y.A,{children:(0,F.jsx)(t.A,{variant:"body2",children:e.fechaJuramentacion?new Date(e.fechaJuramentacion.seconds?e.fechaJuramentacion.toDate():e.fechaJuramentacion).toLocaleDateString("es-PE"):"-"})}),(0,F.jsx)(y.A,{children:(0,F.jsxs)(n.A,{sx:{display:"flex",gap:.5},children:[(0,F.jsx)(S.A,{title:"Ver detalles",children:(0,F.jsx)(P.A,{size:"small",onClick:()=>r(`/personal/ver/${e.id}`),children:(0,F.jsx)(I.A,{})})}),(0,F.jsx)(S.A,{title:"Editar",children:(0,F.jsx)(P.A,{size:"small",onClick:()=>r(`/personal/editar/${e.id}`),children:(0,F.jsx)(H.A,{})})}),(0,F.jsx)(S.A,{title:"Eliminar",children:(0,F.jsx)(P.A,{size:"small",color:"error",onClick:()=>ge({open:!0,socio:e}),children:(0,F.jsx)(L.A,{})})})]})})]},e.id)})})]})}),(0,F.jsx)(k.A,{rowsPerPageOptions:[5,10,25,50],component:"div",count:fe.length,rowsPerPage:ie,page:te,onPageChange:(e,a)=>{ce(a)},onRowsPerPageChange:e=>{le(parseInt(e.target.value,10)),ce(0)},labelRowsPerPage:"Filas por p\xe1gina:",labelDisplayedRows:e=>{let{from:a,to:r,count:s}=e;return`${a}-${r} de ${-1!==s?s:`m\xe1s de ${r}`}`}})]}),(0,F.jsxs)(N.A,{open:xe.open,onClose:()=>ge({open:!1,socio:null}),maxWidth:"sm",fullWidth:!0,children:[(0,F.jsx)(M.A,{children:"Confirmar Eliminaci\xf3n"}),(0,F.jsxs)(Z.A,{children:[(0,F.jsxs)(t.A,{children:["\xbfEst\xe1s seguro de que deseas eliminar del personal a"," ",(0,F.jsxs)("strong",{children:[null===(e=xe.socio)||void 0===e?void 0:e.nombres," ",null===(a=xe.socio)||void 0===a?void 0:a.apellidos]}),"?"]}),(0,F.jsx)(t.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Esta acci\xf3n no se puede deshacer."})]}),(0,F.jsxs)(D.A,{children:[(0,F.jsx)(h.A,{onClick:()=>ge({open:!1,socio:null}),children:"Cancelar"}),(0,F.jsx)(h.A,{onClick:async()=>{try{const e=await W.A.deleteSocio(xe.socio.id);e.success?(Q(e.message),ve(),ge({open:!1,socio:null})):V(e.error)}catch(q){console.error("Error al eliminar personal:",q),V("Error al eliminar el personal")}},color:"error",variant:"contained",children:"Eliminar"})]})]})]})}},1236:(e,a,r)=>{r.d(a,{A:()=>n});var s=r(6667),o=r(6860);const n=new class{constructor(){this.collectionName="personal"}async createSocio(e){try{const a=o.j2.currentUser;if(!a)throw new Error("Usuario no autenticado");const r={...e,estado:e.estado||"activo",fechaRegistro:e.fechaRegistro||(0,s.O5)(),fechaCreacion:(0,s.O5)(),fechaModificacion:(0,s.O5)(),creadoPor:a.uid};return{success:!0,id:(await(0,s.gS)((0,s.rJ)(o.db,this.collectionName),r)).id,message:"Personal creado exitosamente"}}catch(a){return console.error("Error al crear socio:",a),{success:!1,error:this.getErrorMessage(a)}}}async getSocios(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const{pageSize:a=100,searchTerm:r="",zona:n="",campana:t="",estado:c=""}=e;console.log("\ud83d\udd0d Buscando personal con filtros:",{searchTerm:r,zona:n,campana:t,estado:c});let i=(0,s.rJ)(o.db,this.collectionName);i=(0,s.P)(i,(0,s.My)("fechaCreacion","desc"),(0,s.AB)(a));let l=(await(0,s.GG)(i)).docs.map(e=>({id:e.id,...e.data()}));if(console.log("\ud83d\udcca Total documentos obtenidos:",l.length),n&&""!==n?(l=l.filter(e=>e.zona===n),console.log("\ud83c\udfe2 Filtrados por zona:",l.length)):""===n&&console.log("\ud83c\udfe2 Mostrando todas las zonas"),t&&(l=l.filter(e=>e.campana===t),console.log("\ud83d\udce2 Filtrados por campa\xf1a:",l.length)),c&&(l=l.filter(e=>e.estado===c),console.log("\ud83d\udcca Filtrados por estado:",l.length)),r){const e=r.toLowerCase();l=l.filter(a=>(a.nombres||"").toLowerCase().includes(e)||(a.apellidos||"").toLowerCase().includes(e)||(a.celular||"").includes(e)||(a.dni||"").includes(e)),console.log("\ud83d\udd0d Filtrados por b\xfasqueda:",l.length)}return console.log("\u2705 Personal encontrado:",l.length),{success:!0,data:l,total:l.length}}catch(a){return console.error("\u274c Error al obtener personal:",a),{success:!1,error:this.getErrorMessage(a)}}}async getSocioById(e){try{const a=await(0,s.x7)((0,s.H9)(o.db,this.collectionName,e));return a.exists()?{success:!0,data:{id:a.id,...a.data()}}:{success:!1,error:"Personal no encontrado"}}catch(a){return console.error("Error al obtener personal:",a),{success:!1,error:this.getErrorMessage(a)}}}async updateSocio(e,a){try{const r=o.j2.currentUser;if(!r)throw new Error("Usuario no autenticado");const n={...a,fechaModificacion:(0,s.O5)(),modificadoPor:r.uid};return await(0,s.mZ)((0,s.H9)(o.db,this.collectionName,e),n),{success:!0,message:"Personal actualizado exitosamente"}}catch(r){return console.error("Error al actualizar personal:",r),{success:!1,error:this.getErrorMessage(r)}}}async deleteSocio(e){try{if(!o.j2.currentUser)throw new Error("Usuario no autenticado");return await(0,s.kd)((0,s.H9)(o.db,this.collectionName,e)),{success:!0,message:"Personal eliminado exitosamente"}}catch(a){return console.error("Error al eliminar personal:",a),{success:!1,error:this.getErrorMessage(a)}}}async getStats(){try{const e=(await(0,s.GG)((0,s.rJ)(o.db,this.collectionName))).docs.map(e=>e.data()),a=e.length,r=e.filter(e=>"activo"===e.estado).length,n=new Date;n.setDate(1),n.setHours(0,0,0,0);const t=e.filter(e=>{var a,r;return((null===(a=e.fechaCreacion)||void 0===a||null===(r=a.toDate)||void 0===r?void 0:r.call(a))||new Date(e.fechaCreacion))>=n}).length,c={};return e.forEach(e=>{e.zona&&(c[e.zona]=(c[e.zona]||0)+1)}),{success:!0,data:{total:a,activos:r,inactivos:a-r,nuevosMes:t,zonaStats:c}}}catch(e){return console.error("Error al obtener estad\xedsticas:",e),{success:!1,error:this.getErrorMessage(e)}}}async bulkDelete(e){try{const a=(0,s.wP)(o.db);return e.forEach(e=>{const r=(0,s.H9)(o.db,this.collectionName,e);a.delete(r)}),await a.commit(),{success:!0,message:`${e.length} socios eliminados exitosamente`}}catch(a){return console.error("Error en eliminaci\xf3n masiva:",a),{success:!1,error:this.getErrorMessage(a)}}}async updateEstado(e,a){return this.updateSocio(e,{estado:a})}getErrorMessage(e){const a={"permission-denied":"No tienes permisos para realizar esta operaci\xf3n","not-found":"El socio no fue encontrado",unavailable:"Servicio no disponible. Por favor, intenta m\xe1s tarde","failed-precondition":"Error en la operaci\xf3n. Verifica los datos","invalid-argument":"Datos inv\xe1lidos proporcionados"};return e.code&&a[e.code]?a[e.code]:e.message||"Ha ocurrido un error inesperado"}}},3264:(e,a,r)=>{r.d(a,{A:()=>n});var s=r(6667),o=r(6860);const n=new class{constructor(){this.collectionName="zonas"}async createZona(e){try{const a=o.j2.currentUser;if(!a)throw new Error("Usuario no autenticado");const r={...e,activa:void 0===e.activa||e.activa,fechaCreacion:(0,s.O5)(),fechaModificacion:(0,s.O5)(),creadoPor:a.uid},n=await(0,s.gS)((0,s.rJ)(o.db,this.collectionName),r);return{success:!0,id:n.id,data:{id:n.id,...r},message:"Zona creada exitosamente"}}catch(a){return{success:!1,error:a.message||"Error al crear zona"}}}async getZonas(){try{const e=(0,s.P)((0,s.rJ)(o.db,this.collectionName),(0,s.My)("nombre","asc")),a=await(0,s.GG)(e);return{success:!0,data:a.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas"}}}async getZonasActivas(){try{const e=(0,s.P)((0,s.rJ)(o.db,this.collectionName),(0,s._M)("activa","==",!0),(0,s.My)("nombre","asc")),a=await(0,s.GG)(e);return{success:!0,data:a.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas activas"}}}async updateZona(e,a){try{return await(0,s.mZ)((0,s.H9)(o.db,this.collectionName,e),{...a,fechaModificacion:(0,s.O5)()}),{success:!0,message:"Zona actualizada exitosamente"}}catch(r){return{success:!1,error:r.message||"Error al actualizar zona"}}}async getZonaById(e){try{const a=await(0,s.x7)((0,s.H9)(o.db,this.collectionName,e));return a.exists()?{success:!0,data:{id:a.id,...a.data()}}:{success:!1,error:"Zona no encontrada"}}catch(a){return{success:!1,error:a.message||"Error al obtener zona"}}}async deleteZona(e){try{const a=await(0,s.x7)((0,s.H9)(o.db,this.collectionName,e));if(!a.exists())return{success:!1,error:"Zona no encontrada"};const r=a.data().nombre,n=await(0,s.GG)((0,s.P)((0,s.rJ)(o.db,"personal"),(0,s._M)("zona","==",r)));return n.empty?(await(0,s.kd)((0,s.H9)(o.db,this.collectionName,e)),{success:!0,message:"Zona eliminada exitosamente"}):{success:!1,error:`No se puede eliminar la zona "${r}" porque tiene ${n.size} personal(es) asociado(s)`}}catch(a){return{success:!1,error:a.message||"Error al eliminar zona"}}}async getStats(){try{const e=await(0,s.GG)((0,s.rJ)(o.db,this.collectionName)),a=await(0,s.GG)((0,s.rJ)(o.db,"Personal")),r=e.docs.map(e=>({id:e.id,...e.data()})),n=a.docs.map(e=>e.data()),t=r.length,c=r.filter(e=>e.activa).length,i={};return n.forEach(e=>{e.zona&&(i[e.zona]=(i[e.zona]||0)+1)}),{success:!0,data:{total:t,activas:c,inactivas:t-c,personalPorZona:i}}}catch(e){return{success:!1,error:e.message||"Error al obtener estad\xedsticas"}}}}}}]);
//# sourceMappingURL=106.2b661563.chunk.js.map