"use strict";(self.webpackChunkpersonal_app=self.webpackChunkpersonal_app||[]).push([[106],{106:(e,r,s)=>{s.r(r),s.d(r,{default:()=>B});var a=s(5043),o=s(9806),n=s(3969),t=s(5895),c=s(1449),i=s(4799),l=s(3089),d=s(6154),h=s(2097),u=s(172),m=s(256),x=s(9067),g=s(7203),p=s(7471),A=s(8259),j=s(7443),b=s(756),v=s(6172),y=s(1341),f=s(6711),w=s(1778),E=s(4375),z=s(7873),C=s(3759),S=s(6529),P=s(2579),k=s(3919),N=s(3023),M=s(1911),Z=s(8776),G=s(5877),L=s(2950),H=s(8916),D=s(5362),I=s(1773),O=s(3745),J=s(3665),U=s(9615),$=s(1236),W=s(3264),F=s(579);const B=function(){var e,r;const s=(0,U.Zp)(),[B,R]=(0,a.useState)([]),[T,_]=(0,a.useState)(!0),[q,V]=(0,a.useState)(""),[K,Q]=(0,a.useState)(""),[X,Y]=(0,a.useState)(""),[ee,re]=(0,a.useState)(""),[se,ae]=(0,a.useState)(""),[oe,ne]=(0,a.useState)([]),[te,ce]=(0,a.useState)(0),[ie,le]=(0,a.useState)(10),[de,he]=(0,a.useState)("asc"),[ue,me]=(0,a.useState)("dni"),[xe,ge]=(0,a.useState)({open:!1,socio:null}),[pe,Ae]=(0,a.useState)([]);(0,a.useEffect)(()=>{be(),ve()},[]);const je=()=>{ve()};(0,a.useEffect)(()=>{ve()},[ee]);const be=async()=>{try{const e=await W.A.getZonas();e.success?ne(Array.isArray(e.data)?e.data:[]):(console.error("Error cargando zonas:",e.error),ne([]))}catch(q){console.error("Error cargando datos iniciales:",q),ne([])}},ve=async()=>{_(!0),V("");try{console.log("\ud83d\udd0d Aplicando filtros:",{searchTerm:X,zona:ee});const e=await $.A.getSocios({searchTerm:X,zona:ee});if(e.success){const r=Array.isArray(e.data)?e.data:[];R(r),Ae([])}else V(e.error||"Error al cargar el personal"),R([])}catch(q){console.error("Error al cargar personal:",q),V("Error al cargar el personal"),R([])}finally{_(!1)}},ye=(e,r,s)=>r[s]<e[s]?-1:r[s]>e[s]?1:0,fe=B.filter(e=>{var r,s,a,o;const n=!X||(null===(r=e.dni)||void 0===r?void 0:r.toLowerCase().includes(X.toLowerCase()))||(null===(s=e.nombres)||void 0===s?void 0:s.toLowerCase().includes(X.toLowerCase()))||(null===(a=e.apellidos)||void 0===a?void 0:a.toLowerCase().includes(X.toLowerCase()))||(null===(o=e.celular)||void 0===o?void 0:o.toLowerCase().includes(X.toLowerCase())),t=!ee||e.zona===ee;return n&&t}),we=((e,r)=>{const s=e.map((e,r)=>[e,r]);return s.sort((e,s)=>{const a=r(e[0],s[0]);return 0!==a?a:e[1]-s[1]}),s.map(e=>e[0])})(fe,((e,r)=>"desc"===e?(e,s)=>ye(e,s,r):(e,s)=>-ye(e,s,r))(de,ue)).slice(te*ie,te*ie+ie);return(0,F.jsxs)(o.A,{maxWidth:"xl",children:[(0,F.jsxs)(n.A,{sx:{mb:3},children:[(0,F.jsx)(t.A,{variant:"h4",gutterBottom:!0,children:"Lista de Personal"}),(0,F.jsx)(t.A,{variant:"body1",color:"text.secondary",children:"Gestiona todo el personal registrado en el sistema"})]}),q&&(0,F.jsx)(c.A,{severity:"error",sx:{mb:3},onClose:()=>V(""),children:q}),K&&(0,F.jsx)(c.A,{severity:"success",sx:{mb:3},onClose:()=>Q(""),children:K}),(0,F.jsxs)(i.A,{sx:{p:3,mb:3},children:[(0,F.jsxs)(l.A,{container:!0,spacing:2,alignItems:"center",children:[(0,F.jsx)(l.A,{item:!0,xs:12,md:3,children:(0,F.jsxs)(n.A,{display:"flex",gap:1,children:[(0,F.jsx)(d.A,{fullWidth:!0,placeholder:"Buscar personal por DNI, nombre, apellido o celular...",value:X,onChange:e=>Y(e.target.value),onKeyPress:e=>{"Enter"===e.key&&je()},InputProps:{startAdornment:(0,F.jsx)(O.A,{sx:{mr:1,color:"text.secondary"}})}}),(0,F.jsx)(h.A,{variant:"outlined",onClick:je,disabled:T,sx:{minWidth:"auto",px:2},children:T?(0,F.jsx)(u.A,{size:20}):(0,F.jsx)(O.A,{})})]})}),(0,F.jsx)(l.A,{item:!0,xs:12,md:2,children:(0,F.jsxs)(m.A,{fullWidth:!0,size:"small",children:[(0,F.jsx)(x.A,{children:"Zona"}),(0,F.jsxs)(g.A,{value:ee,label:"Zona",sx:{minWidth:120},onChange:e=>re(e.target.value),children:[(0,F.jsx)(p.A,{value:"",children:"Todas"}),oe.map(e=>(0,F.jsx)(p.A,{value:e.nombre,children:e.nombre},e.id))]})]})}),(0,F.jsx)(l.A,{item:!0,xs:12,md:5,children:(0,F.jsxs)(n.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[(0,F.jsx)(h.A,{variant:"outlined",startIcon:(0,F.jsx)(H.A,{}),onClick:()=>{Y(""),re(""),ve()},children:"Limpiar"}),(0,F.jsx)(h.A,{variant:"contained",startIcon:(0,F.jsx)(L.A,{}),onClick:()=>s("/personal/nuevo"),children:"Nuevo Personal"})]})})]}),pe.length>0&&(0,F.jsxs)(n.A,{sx:{mt:2,p:2,bgcolor:"action.selected",borderRadius:1},children:[(0,F.jsxs)(t.A,{variant:"body2",sx:{mb:1},children:[pe.length," persona(s) seleccionada(s)"]}),(0,F.jsx)(h.A,{variant:"outlined",color:"error",size:"small",startIcon:(0,F.jsx)(D.A,{}),onClick:async()=>{if(0!==pe.length)try{const e=await $.A.bulkDelete(pe);e.success?(Q(e.message),Ae([]),ve()):V(e.error)}catch(q){console.error("Error en eliminaci\xf3n masiva:",q),V("Error en la eliminaci\xf3n masiva")}},children:"Eliminar seleccionados"})]})]}),(0,F.jsxs)(i.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,F.jsx)(A.A,{sx:{maxHeight:440},children:(0,F.jsxs)(j.A,{stickyHeader:!0,children:[(0,F.jsx)(b.A,{children:(0,F.jsxs)(v.A,{children:[(0,F.jsx)(y.A,{padding:"checkbox",children:(0,F.jsx)(f.A,{color:"primary",indeterminate:pe.length>0&&pe.length<B.length,checked:B.length>0&&pe.length===B.length,onChange:e=>{if(e.target.checked){const e=B.map(e=>e.id);return void Ae(e)}Ae([])}})}),(0,F.jsx)(y.A,{width:60,children:"Avatar"}),[{id:"dni",label:"DNI",sortable:!0,width:100},{id:"nombres",label:"Nombres",sortable:!0,width:140},{id:"apellidos",label:"Apellidos",sortable:!0,width:140},{id:"celular",label:"Celular",sortable:!0,width:110},{id:"zona",label:"Zona",sortable:!0,width:150},{id:"acciones",label:"Acciones",sortable:!1,width:150}].map(e=>(0,F.jsx)(y.A,{width:e.width,sortDirection:ue===e.id&&de,children:e.sortable?(0,F.jsx)(w.A,{active:ue===e.id,direction:ue===e.id?de:"asc",onClick:()=>{return r=e.id,he(ue===r&&"asc"===de?"desc":"asc"),void me(r);var r},children:e.label}):e.label},e.id))]})}),(0,F.jsx)(E.A,{children:T?(0,F.jsx)(v.A,{children:(0,F.jsx)(y.A,{colSpan:8,align:"center",children:(0,F.jsx)(u.A,{})})}):0===we.length?(0,F.jsx)(v.A,{children:(0,F.jsx)(y.A,{colSpan:8,align:"center",children:(0,F.jsx)(t.A,{variant:"body2",color:"text.secondary",children:"No hay personal registrado"})})}):we.map(e=>{const r=(a=e.id,-1!==pe.indexOf(a));var a,o,c;return(0,F.jsxs)(v.A,{hover:!0,selected:r,children:[(0,F.jsx)(y.A,{padding:"checkbox",children:(0,F.jsx)(f.A,{color:"primary",checked:r,onChange:r=>((e,r)=>{const s=pe.indexOf(r);let a=[];-1===s?a=a.concat(pe,r):0===s?a=a.concat(pe.slice(1)):s===pe.length-1?a=a.concat(pe.slice(0,-1)):s>0&&(a=a.concat(pe.slice(0,s),pe.slice(s+1))),Ae(a)})(0,e.id)})}),(0,F.jsx)(y.A,{children:(0,F.jsx)(z.A,{sx:{width:32,height:32,bgcolor:"primary.main"},children:(o=e.nombres,c=e.apellidos,((o?o.charAt(0):"")+(c?c.charAt(0):"")).toUpperCase())})}),(0,F.jsx)(y.A,{children:(0,F.jsx)(t.A,{variant:"body2",fontFamily:"monospace",fontWeight:"bold",children:e.dni||"-"})}),(0,F.jsx)(y.A,{children:e.nombres||"-"}),(0,F.jsx)(y.A,{children:e.apellidos||"-"}),(0,F.jsx)(y.A,{children:(0,F.jsx)(t.A,{variant:"body2",fontFamily:"monospace",children:e.celular||"-"})}),(0,F.jsx)(y.A,{children:(0,F.jsx)(C.A,{label:e.zona||"Sin zona",size:"small",variant:"outlined",color:"primary"})}),(0,F.jsx)(y.A,{children:(0,F.jsxs)(n.A,{sx:{display:"flex",gap:.5},children:[(0,F.jsx)(S.A,{title:"Ver detalles",children:(0,F.jsx)(P.A,{size:"small",onClick:()=>s(`/personal/ver/${e.id}`),children:(0,F.jsx)(J.A,{})})}),(0,F.jsx)(S.A,{title:"Editar",children:(0,F.jsx)(P.A,{size:"small",onClick:()=>s(`/personal/editar/${e.id}`),children:(0,F.jsx)(I.A,{})})}),(0,F.jsx)(S.A,{title:"Eliminar",children:(0,F.jsx)(P.A,{size:"small",color:"error",onClick:()=>ge({open:!0,socio:e}),children:(0,F.jsx)(D.A,{})})})]})})]},e.id)})})]})}),(0,F.jsx)(k.A,{rowsPerPageOptions:[5,10,25,50],component:"div",count:fe.length,rowsPerPage:ie,page:te,onPageChange:(e,r)=>{ce(r)},onRowsPerPageChange:e=>{le(parseInt(e.target.value,10)),ce(0)},labelRowsPerPage:"Filas por p\xe1gina:",labelDisplayedRows:e=>{let{from:r,to:s,count:a}=e;return`${r}-${s} de ${-1!==a?a:`m\xe1s de ${s}`}`}})]}),(0,F.jsxs)(N.A,{open:xe.open,onClose:()=>ge({open:!1,socio:null}),maxWidth:"sm",fullWidth:!0,children:[(0,F.jsx)(M.A,{children:"Confirmar Eliminaci\xf3n"}),(0,F.jsxs)(Z.A,{children:[(0,F.jsxs)(t.A,{children:["\xbfEst\xe1s seguro de que deseas eliminar del personal a"," ",(0,F.jsxs)("strong",{children:[null===(e=xe.socio)||void 0===e?void 0:e.nombres," ",null===(r=xe.socio)||void 0===r?void 0:r.apellidos]}),"?"]}),(0,F.jsx)(t.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Esta acci\xf3n no se puede deshacer."})]}),(0,F.jsxs)(G.A,{children:[(0,F.jsx)(h.A,{onClick:()=>ge({open:!1,socio:null}),children:"Cancelar"}),(0,F.jsx)(h.A,{onClick:async()=>{try{const e=await $.A.deleteSocio(xe.socio.id);e.success?(Q(e.message),ve(),ge({open:!1,socio:null})):V(e.error)}catch(q){console.error("Error al eliminar personal:",q),V("Error al eliminar el personal")}},color:"error",variant:"contained",children:"Eliminar"})]})]})]})}},1236:(e,r,s)=>{s.d(r,{A:()=>n});var a=s(6667),o=s(6860);const n=new class{constructor(){this.collectionName="personal"}async createSocio(e){try{const r=o.j2.currentUser;if(!r)throw new Error("Usuario no autenticado");const s={...e,estado:e.estado||"activo",fechaRegistro:e.fechaRegistro||(0,a.O5)(),fechaCreacion:(0,a.O5)(),fechaModificacion:(0,a.O5)(),creadoPor:r.uid};return{success:!0,id:(await(0,a.gS)((0,a.rJ)(o.db,this.collectionName),s)).id,message:"Personal creado exitosamente"}}catch(r){return console.error("Error al crear socio:",r),{success:!1,error:this.getErrorMessage(r)}}}async getSocios(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const{pageSize:r=100,searchTerm:s="",zona:n="",campana:t="",estado:c=""}=e;console.log("\ud83d\udd0d Buscando personal con filtros:",{searchTerm:s,zona:n,campana:t,estado:c});let i=(0,a.rJ)(o.db,this.collectionName);i=(0,a.P)(i,(0,a.My)("fechaCreacion","desc"),(0,a.AB)(r));let l=(await(0,a.GG)(i)).docs.map(e=>({id:e.id,...e.data()}));if(console.log("\ud83d\udcca Total documentos obtenidos:",l.length),n&&""!==n?(l=l.filter(e=>e.zona===n),console.log("\ud83c\udfe2 Filtrados por zona:",l.length)):""===n&&console.log("\ud83c\udfe2 Mostrando todas las zonas"),t&&(l=l.filter(e=>e.campana===t),console.log("\ud83d\udce2 Filtrados por campa\xf1a:",l.length)),c&&(l=l.filter(e=>e.estado===c),console.log("\ud83d\udcca Filtrados por estado:",l.length)),s){const e=s.toLowerCase();l=l.filter(r=>(r.nombres||"").toLowerCase().includes(e)||(r.apellidos||"").toLowerCase().includes(e)||(r.celular||"").includes(e)||(r.dni||"").includes(e)),console.log("\ud83d\udd0d Filtrados por b\xfasqueda:",l.length)}return console.log("\u2705 Personal encontrado:",l.length),{success:!0,data:l,total:l.length}}catch(r){return console.error("\u274c Error al obtener personal:",r),{success:!1,error:this.getErrorMessage(r)}}}async getSocioById(e){try{const r=await(0,a.x7)((0,a.H9)(o.db,this.collectionName,e));return r.exists()?{success:!0,data:{id:r.id,...r.data()}}:{success:!1,error:"Personal no encontrado"}}catch(r){return console.error("Error al obtener personal:",r),{success:!1,error:this.getErrorMessage(r)}}}async updateSocio(e,r){try{const s=o.j2.currentUser;if(!s)throw new Error("Usuario no autenticado");const n={...r,fechaModificacion:(0,a.O5)(),modificadoPor:s.uid};return await(0,a.mZ)((0,a.H9)(o.db,this.collectionName,e),n),{success:!0,message:"Personal actualizado exitosamente"}}catch(s){return console.error("Error al actualizar personal:",s),{success:!1,error:this.getErrorMessage(s)}}}async deleteSocio(e){try{if(!o.j2.currentUser)throw new Error("Usuario no autenticado");return await(0,a.kd)((0,a.H9)(o.db,this.collectionName,e)),{success:!0,message:"Personal eliminado exitosamente"}}catch(r){return console.error("Error al eliminar personal:",r),{success:!1,error:this.getErrorMessage(r)}}}async getStats(){try{const e=(await(0,a.GG)((0,a.rJ)(o.db,this.collectionName))).docs.map(e=>e.data()),r=e.length,s=e.filter(e=>"activo"===e.estado).length,n=new Date;n.setDate(1),n.setHours(0,0,0,0);const t=e.filter(e=>{var r,s;return((null===(r=e.fechaCreacion)||void 0===r||null===(s=r.toDate)||void 0===s?void 0:s.call(r))||new Date(e.fechaCreacion))>=n}).length,c={};return e.forEach(e=>{e.zona&&(c[e.zona]=(c[e.zona]||0)+1)}),{success:!0,data:{total:r,activos:s,inactivos:r-s,nuevosMes:t,zonaStats:c}}}catch(e){return console.error("Error al obtener estad\xedsticas:",e),{success:!1,error:this.getErrorMessage(e)}}}async bulkDelete(e){try{const r=(0,a.wP)(o.db);return e.forEach(e=>{const s=(0,a.H9)(o.db,this.collectionName,e);r.delete(s)}),await r.commit(),{success:!0,message:`${e.length} socios eliminados exitosamente`}}catch(r){return console.error("Error en eliminaci\xf3n masiva:",r),{success:!1,error:this.getErrorMessage(r)}}}async updateEstado(e,r){return this.updateSocio(e,{estado:r})}getErrorMessage(e){const r={"permission-denied":"No tienes permisos para realizar esta operaci\xf3n","not-found":"El socio no fue encontrado",unavailable:"Servicio no disponible. Por favor, intenta m\xe1s tarde","failed-precondition":"Error en la operaci\xf3n. Verifica los datos","invalid-argument":"Datos inv\xe1lidos proporcionados"};return e.code&&r[e.code]?r[e.code]:e.message||"Ha ocurrido un error inesperado"}}},3264:(e,r,s)=>{s.d(r,{A:()=>n});var a=s(6667),o=s(6860);const n=new class{constructor(){this.collectionName="zonas"}async createZona(e){try{const r=o.j2.currentUser;if(!r)throw new Error("Usuario no autenticado");const s={...e,activa:void 0===e.activa||e.activa,fechaCreacion:(0,a.O5)(),fechaModificacion:(0,a.O5)(),creadoPor:r.uid},n=await(0,a.gS)((0,a.rJ)(o.db,this.collectionName),s);return{success:!0,id:n.id,data:{id:n.id,...s},message:"Zona creada exitosamente"}}catch(r){return{success:!1,error:r.message||"Error al crear zona"}}}async getZonas(){try{const e=(0,a.P)((0,a.rJ)(o.db,this.collectionName),(0,a.My)("nombre","asc")),r=await(0,a.GG)(e);return{success:!0,data:r.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas"}}}async getZonasActivas(){try{const e=(0,a.P)((0,a.rJ)(o.db,this.collectionName),(0,a._M)("activa","==",!0),(0,a.My)("nombre","asc")),r=await(0,a.GG)(e);return{success:!0,data:r.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas activas"}}}async updateZona(e,r){try{return await(0,a.mZ)((0,a.H9)(o.db,this.collectionName,e),{...r,fechaModificacion:(0,a.O5)()}),{success:!0,message:"Zona actualizada exitosamente"}}catch(s){return{success:!1,error:s.message||"Error al actualizar zona"}}}async getZonaById(e){try{const r=await(0,a.x7)((0,a.H9)(o.db,this.collectionName,e));return r.exists()?{success:!0,data:{id:r.id,...r.data()}}:{success:!1,error:"Zona no encontrada"}}catch(r){return{success:!1,error:r.message||"Error al obtener zona"}}}async deleteZona(e){try{const r=await(0,a.x7)((0,a.H9)(o.db,this.collectionName,e));if(!r.exists())return{success:!1,error:"Zona no encontrada"};const s=r.data().nombre,n=await(0,a.GG)((0,a.P)((0,a.rJ)(o.db,"personal"),(0,a._M)("zona","==",s)));return n.empty?(await(0,a.kd)((0,a.H9)(o.db,this.collectionName,e)),{success:!0,message:"Zona eliminada exitosamente"}):{success:!1,error:`No se puede eliminar la zona "${s}" porque tiene ${n.size} personal(es) asociado(s)`}}catch(r){return{success:!1,error:r.message||"Error al eliminar zona"}}}async getStats(){try{const e=await(0,a.GG)((0,a.rJ)(o.db,this.collectionName)),r=await(0,a.GG)((0,a.rJ)(o.db,"Personal")),s=e.docs.map(e=>({id:e.id,...e.data()})),n=r.docs.map(e=>e.data()),t=s.length,c=s.filter(e=>e.activa).length,i={};return n.forEach(e=>{e.zona&&(i[e.zona]=(i[e.zona]||0)+1)}),{success:!0,data:{total:t,activas:c,inactivas:t-c,personalPorZona:i}}}catch(e){return{success:!1,error:e.message||"Error al obtener estad\xedsticas"}}}}}}]);
//# sourceMappingURL=106.e8dfdd59.chunk.js.map