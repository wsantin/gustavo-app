"use strict";(self.webpackChunkpersonal_app=self.webpackChunkpersonal_app||[]).push([[248],{1244:(e,r,s)=>{s.d(r,{A:()=>h});var a=s(5043),n=s(8387),o=s(1807),c=s(8128),i=s(8301),t=s(4799),l=s(9857),d=s(6061);function m(e){return(0,d.Ay)("MuiCard",e)}(0,l.A)("MuiCard",["root"]);var u=s(579);const x=(0,c.Ay)(t.A,{name:"MuiCard",slot:"Root"})({overflow:"hidden"}),h=a.forwardRef(function(e,r){const s=(0,i.b)({props:e,name:"MuiCard"}),{className:a,raised:c=!1,...t}=s,l={...s,raised:c},d=(e=>{const{classes:r}=e;return(0,o.A)({root:["root"]},m,r)})(l);return(0,u.jsx)(x,{className:(0,n.A)(d.root,a),elevation:c?8:void 0,ref:r,ownerState:l,...t})})},3264:(e,r,s)=>{s.d(r,{A:()=>o});var a=s(6667),n=s(6860);const o=new class{constructor(){this.collectionName="zonas"}async createZona(e){try{const r=n.j2.currentUser;if(!r)throw new Error("Usuario no autenticado");const s={...e,activa:void 0===e.activa||e.activa,fechaCreacion:(0,a.O5)(),fechaModificacion:(0,a.O5)(),creadoPor:r.uid},o=await(0,a.gS)((0,a.rJ)(n.db,this.collectionName),s);return{success:!0,id:o.id,data:{id:o.id,...s},message:"Zona creada exitosamente"}}catch(r){return{success:!1,error:r.message||"Error al crear zona"}}}async getZonas(){try{const e=(0,a.P)((0,a.rJ)(n.db,this.collectionName),(0,a.My)("nombre","asc")),r=await(0,a.GG)(e);return{success:!0,data:r.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas"}}}async getZonasActivas(){try{const e=(0,a.P)((0,a.rJ)(n.db,this.collectionName),(0,a._M)("activa","==",!0),(0,a.My)("nombre","asc")),r=await(0,a.GG)(e);return{success:!0,data:r.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas activas"}}}async updateZona(e,r){try{return await(0,a.mZ)((0,a.H9)(n.db,this.collectionName,e),{...r,fechaModificacion:(0,a.O5)()}),{success:!0,message:"Zona actualizada exitosamente"}}catch(s){return{success:!1,error:s.message||"Error al actualizar zona"}}}async getZonaById(e){try{const r=await(0,a.x7)((0,a.H9)(n.db,this.collectionName,e));return r.exists()?{success:!0,data:{id:r.id,...r.data()}}:{success:!1,error:"Zona no encontrada"}}catch(r){return{success:!1,error:r.message||"Error al obtener zona"}}}async deleteZona(e){try{const r=await(0,a.x7)((0,a.H9)(n.db,this.collectionName,e));if(!r.exists())return{success:!1,error:"Zona no encontrada"};const s=r.data().nombre,o=await(0,a.GG)((0,a.P)((0,a.rJ)(n.db,"personal"),(0,a._M)("zona","==",s)));return o.empty?(await(0,a.kd)((0,a.H9)(n.db,this.collectionName,e)),{success:!0,message:"Zona eliminada exitosamente"}):{success:!1,error:`No se puede eliminar la zona "${s}" porque tiene ${o.size} personal(es) asociado(s)`}}catch(r){return{success:!1,error:r.message||"Error al eliminar zona"}}}async getStats(){try{const e=await(0,a.GG)((0,a.rJ)(n.db,this.collectionName)),r=await(0,a.GG)((0,a.rJ)(n.db,"Personal")),s=e.docs.map(e=>({id:e.id,...e.data()})),o=r.docs.map(e=>e.data()),c=s.length,i=s.filter(e=>e.activa).length,t={};return o.forEach(e=>{e.zona&&(t[e.zona]=(t[e.zona]||0)+1)}),{success:!0,data:{total:c,activas:i,inactivas:c-i,personalPorZona:t}}}catch(e){return{success:!1,error:e.message||"Error al obtener estad\xedsticas"}}}}},4111:(e,r,s)=>{s.d(r,{Hy:()=>o,OI:()=>c,X5:()=>n});var a=s(899);const n=a.Ik({email:a.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido"),password:a.Yj().min(6,"La contrase\xf1a debe tener al menos 6 caracteres").required("La contrase\xf1a es requerida")}),o=(a.Ik({displayName:a.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(50,"El nombre no puede tener m\xe1s de 50 caracteres").required("El nombre es requerido"),email:a.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido"),password:a.Yj().min(6,"La contrase\xf1a debe tener al menos 6 caracteres").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"La contrase\xf1a debe contener al menos una may\xfascula, una min\xfascula y un n\xfamero").required("La contrase\xf1a es requerida"),confirmPassword:a.Yj().oneOf([a.KR("password"),null],"Las contrase\xf1as no coinciden").required("Confirme su contrase\xf1a")}),a.Ik({email:a.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido")}),a.Ik({currentPassword:a.Yj().required("La contrase\xf1a actual es requerida"),newPassword:a.Yj().min(6,"La nueva contrase\xf1a debe tener al menos 6 caracteres").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"La contrase\xf1a debe contener al menos una may\xfascula, una min\xfascula y un n\xfamero").required("La nueva contrase\xf1a es requerida"),confirmNewPassword:a.Yj().oneOf([a.KR("newPassword"),null],"Las contrase\xf1as no coinciden").required("Confirme su nueva contrase\xf1a")}),a.Ik({dni:a.Yj().matches(/^\d{8}$/,"El DNI debe tener exactamente 8 d\xedgitos").required("El DNI es requerido"),nombres:a.Yj().min(2,"Los nombres deben tener al menos 2 caracteres").max(50,"Los nombres no pueden tener m\xe1s de 50 caracteres").matches(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/,"Los nombres solo pueden contener letras").required("Los nombres son requeridos"),apellidos:a.Yj().min(2,"Los apellidos deben tener al menos 2 caracteres").max(50,"Los apellidos no pueden tener m\xe1s de 50 caracteres").matches(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/,"Los apellidos solo pueden contener letras").required("Los apellidos son requeridos"),celular:a.Yj().matches(/^9\d{8}$/,"El celular debe empezar con 9 y tener 9 d\xedgitos").required("El celular es requerido"),zona:a.Yj().required("La zona es requerida")})),c=a.Ik({nombre:a.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(50,"El nombre no puede tener m\xe1s de 50 caracteres").required("El nombre es requerido"),descripcion:a.Yj().max(200,"La descripci\xf3n no puede tener m\xe1s de 200 caracteres").optional()});a.Ik({nombre:a.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(100,"El nombre no puede tener m\xe1s de 100 caracteres").required("El nombre es requerido"),descripcion:a.Yj().max(500,"La descripci\xf3n no puede tener m\xe1s de 500 caracteres").optional(),fechaInicio:a.p6().required("La fecha de inicio es requerida"),fechaFin:a.p6().min(a.KR("fechaInicio"),"La fecha de fin debe ser posterior a la de inicio").required("La fecha de fin es requerida"),activa:a.zM().required("El estado es requerido")})},6128:(e,r,s)=>{s.d(r,{A:()=>x});var a=s(5043),n=s(8387),o=s(1807),c=s(8128),i=s(8301),t=s(9857),l=s(6061);function d(e){return(0,l.Ay)("MuiCardContent",e)}(0,t.A)("MuiCardContent",["root"]);var m=s(579);const u=(0,c.Ay)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}}),x=a.forwardRef(function(e,r){const s=(0,i.b)({props:e,name:"MuiCardContent"}),{className:a,component:c="div",...t}=s,l={...s,component:c},x=(e=>{const{classes:r}=e;return(0,o.A)({root:["root"]},d,r)})(l);return(0,m.jsx)(u,{as:c,className:(0,n.A)(x.root,a),ownerState:l,ref:r,...t})})},9248:(e,r,s)=>{s.r(r),s.d(r,{default:()=>H});var a=s(5043),n=s(3023),o=s(1911),c=s(3969),i=s(8776),t=s(3089),l=s(6154),d=s(5895),m=s(2097),u=s(5877),x=s(9806),h=s(1449),j=s(1244),A=s(6128),p=s(4799),v=s(8259),b=s(7443),y=s(756),f=s(6172),g=s(1341),C=s(4375),z=s(172),E=s(3759),w=s(6529),q=s(2579),Z=s(9992),L=s(579);const I=(0,Z.A)((0,L.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn"),N=(0,Z.A)((0,L.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2z"}),"Assessment"),S=(0,Z.A)((0,L.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"People");var k=s(3745),P=s(2950),M=s(1773),Y=s(5362),G=s(4858),D=s(8403),O=s(4111),B=s(3264);const H=function(){var e;const[r,s]=(0,a.useState)([]),[Z,H]=(0,a.useState)(null),[R,J]=(0,a.useState)(!0),[W,$]=(0,a.useState)(""),[V,T]=(0,a.useState)(""),[_,F]=(0,a.useState)(""),[K,U]=(0,a.useState)(!1),[X,Q]=(0,a.useState)(!1),[ee,re]=(0,a.useState)(!1),[se,ae]=(0,a.useState)(null),[ne,oe]=(0,a.useState)({nombre:"",descripcion:"",activa:!0}),{register:ce,handleSubmit:ie,formState:{errors:te},reset:le,setValue:de}=(0,G.mN)({resolver:(0,D.t)(O.OI)});(0,a.useEffect)(()=>{me()},[]);const me=async()=>{J(!0);try{const[e,r]=await Promise.all([B.A.getZonas(),B.A.getStats()]);e.success?s(e.data):$(e.error),r.success&&H(r.data)}catch(W){$("Error al cargar datos")}finally{J(!1)}},ue=async e=>{try{let r;if(r=se?await B.A.updateZona(se.id,e):await B.A.createZona(e),r.success){T(r.message);const e={nombre:"",descripcion:"",activa:!0};oe(e),le(e),ae(null),U(!1),Q(!1),setTimeout(()=>me(),100)}else $(r.error)}catch(W){$("Error inesperado")}},xe=r.filter(e=>{if(!_)return!0;const r=_.toLowerCase();return e.nombre.toLowerCase().includes(r)||(e.descripcion||"").toLowerCase().includes(r)}),he=e=>{if(!e)return"-";try{return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("es-ES")}catch{return"-"}},je=e=>{var r,s;let{open:a,onClose:x,title:h,isEdit:j=!1}=e;return(0,L.jsxs)(n.A,{open:a,onClose:x,maxWidth:"sm",fullWidth:!0,children:[(0,L.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,L.jsx)(I,{color:"primary"}),h]}),(0,L.jsxs)(c.A,{component:"form",onSubmit:ie(ue),children:[(0,L.jsx)(i.A,{children:(0,L.jsxs)(t.A,{container:!0,spacing:3,children:[(0,L.jsx)(t.A,{item:!0,xs:12,children:(0,L.jsx)(l.A,{autoFocus:!0,fullWidth:!0,label:"Nombre de la zona",...ce("nombre"),error:!!te.nombre,helperText:null===(r=te.nombre)||void 0===r?void 0:r.message,placeholder:"Ej: Zona Norte, Centro, etc."})}),(0,L.jsx)(t.A,{item:!0,xs:12,children:(0,L.jsx)(l.A,{fullWidth:!0,label:"Descripci\xf3n (opcional)",multiline:!0,rows:3,...ce("descripcion"),error:!!te.descripcion,helperText:null===(s=te.descripcion)||void 0===s?void 0:s.message,placeholder:"Descripci\xf3n detallada de la zona..."})}),(0,L.jsx)(t.A,{item:!0,xs:12,children:(0,L.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,L.jsx)(d.A,{variant:"body1",children:"Estado:"}),(0,L.jsx)(m.A,{variant:!0===ne.activa?"contained":"outlined",color:"success",onClick:()=>{oe(e=>({...e,activa:!0})),de("activa",!0)},size:"small",children:"Activa"}),(0,L.jsx)(m.A,{variant:!1===ne.activa?"contained":"outlined",color:"error",onClick:()=>{oe(e=>({...e,activa:!1})),de("activa",!1)},size:"small",children:"Inactiva"})]})})]})}),(0,L.jsxs)(u.A,{children:[(0,L.jsx)(m.A,{onClick:x,children:"Cancelar"}),(0,L.jsxs)(m.A,{type:"submit",variant:"contained",children:[j?"Actualizar":"Crear"," Zona"]})]})]})]})};return(0,L.jsxs)(x.A,{maxWidth:"xl",children:[(0,L.jsxs)(c.A,{sx:{mb:3},children:[(0,L.jsxs)(d.A,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,L.jsx)(I,{}),"Gesti\xf3n de Zonas"]}),(0,L.jsx)(d.A,{variant:"body1",color:"text.secondary",children:"Administra las zonas geogr\xe1ficas del sistema"})]}),W&&(0,L.jsx)(h.A,{severity:"error",sx:{mb:3},onClose:()=>$(""),children:W}),V&&(0,L.jsx)(h.A,{severity:"success",sx:{mb:3},onClose:()=>T(""),children:V}),Z&&(0,L.jsxs)(t.A,{container:!0,spacing:3,sx:{mb:3},children:[(0,L.jsx)(t.A,{item:!0,xs:12,sm:6,md:3,children:(0,L.jsx)(j.A,{children:(0,L.jsx)(A.A,{children:(0,L.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,L.jsx)(N,{color:"primary"}),(0,L.jsxs)(c.A,{children:[(0,L.jsx)(d.A,{color:"text.secondary",gutterBottom:!0,children:"Total Zonas"}),(0,L.jsx)(d.A,{variant:"h4",children:Z.total})]})]})})})}),(0,L.jsx)(t.A,{item:!0,xs:12,sm:6,md:3,children:(0,L.jsx)(j.A,{children:(0,L.jsx)(A.A,{children:(0,L.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,L.jsx)(I,{color:"success"}),(0,L.jsxs)(c.A,{children:[(0,L.jsx)(d.A,{color:"text.secondary",gutterBottom:!0,children:"Activas"}),(0,L.jsx)(d.A,{variant:"h4",color:"success.main",children:Z.activas})]})]})})})}),(0,L.jsx)(t.A,{item:!0,xs:12,sm:6,md:3,children:(0,L.jsx)(j.A,{children:(0,L.jsx)(A.A,{children:(0,L.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,L.jsx)(I,{color:"error"}),(0,L.jsxs)(c.A,{children:[(0,L.jsx)(d.A,{color:"text.secondary",gutterBottom:!0,children:"Inactivas"}),(0,L.jsx)(d.A,{variant:"h4",color:"error.main",children:Z.inactivas})]})]})})})}),(0,L.jsx)(t.A,{item:!0,xs:12,sm:6,md:3,children:(0,L.jsx)(j.A,{children:(0,L.jsx)(A.A,{children:(0,L.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,L.jsx)(S,{color:"info"}),(0,L.jsxs)(c.A,{children:[(0,L.jsx)(d.A,{color:"text.secondary",gutterBottom:!0,children:"Con Personal"}),(0,L.jsx)(d.A,{variant:"h4",color:"info.main",children:Object.keys(Z.personalPorZona).length})]})]})})})})]}),(0,L.jsx)(p.A,{sx:{p:3,mb:3},children:(0,L.jsxs)(t.A,{container:!0,spacing:2,alignItems:"center",children:[(0,L.jsx)(t.A,{item:!0,xs:12,md:6,children:(0,L.jsx)(l.A,{fullWidth:!0,placeholder:"Buscar zonas...",value:_,onChange:e=>F(e.target.value),InputProps:{startAdornment:(0,L.jsx)(k.A,{sx:{mr:1,color:"text.secondary"}})}})}),(0,L.jsx)(t.A,{item:!0,xs:12,md:6,children:(0,L.jsx)(c.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:(0,L.jsx)(m.A,{variant:"contained",startIcon:(0,L.jsx)(P.A,{}),onClick:()=>{const e={nombre:"",descripcion:"",activa:!0};oe(e),le(e),ae(null),U(!0)},children:"Nueva Zona"})})})]})}),(0,L.jsx)(p.A,{children:(0,L.jsx)(v.A,{children:(0,L.jsxs)(b.A,{children:[(0,L.jsx)(y.A,{children:(0,L.jsxs)(f.A,{children:[(0,L.jsx)(g.A,{children:"Nombre"}),(0,L.jsx)(g.A,{children:"Descripci\xf3n"}),(0,L.jsx)(g.A,{children:"Estado"}),(0,L.jsx)(g.A,{children:"Personal"}),(0,L.jsx)(g.A,{children:"Fecha Creaci\xf3n"}),(0,L.jsx)(g.A,{children:"Acciones"})]})}),(0,L.jsx)(C.A,{children:R?(0,L.jsx)(f.A,{children:(0,L.jsx)(g.A,{colSpan:6,align:"center",sx:{py:4},children:(0,L.jsx)(z.A,{})})}):0===xe.length?(0,L.jsx)(f.A,{children:(0,L.jsx)(g.A,{colSpan:6,align:"center",sx:{py:4},children:(0,L.jsx)(d.A,{color:"text.secondary",children:_?"No se encontraron zonas":"No hay zonas registradas"})})}):xe.map(e=>{var r;return(0,L.jsxs)(f.A,{children:[(0,L.jsx)(g.A,{children:(0,L.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,L.jsx)(I,{color:"primary"}),(0,L.jsx)(d.A,{variant:"subtitle2",children:e.nombre})]})}),(0,L.jsx)(g.A,{children:(0,L.jsx)(d.A,{variant:"body2",color:"text.secondary",children:e.descripcion||"Sin descripci\xf3n"})}),(0,L.jsx)(g.A,{children:(0,L.jsx)(E.A,{label:e.activa?"Activa":"Inactiva",color:e.activa?"success":"error",size:"small",variant:"filled"})}),(0,L.jsx)(g.A,{children:(0,L.jsx)(E.A,{label:(null===Z||void 0===Z||null===(r=Z.personalPorZona)||void 0===r?void 0:r[e.nombre])||0,color:"info",size:"small",variant:"outlined",icon:(0,L.jsx)(S,{})})}),(0,L.jsx)(g.A,{children:he(e.fechaCreacion)}),(0,L.jsx)(g.A,{children:(0,L.jsxs)(c.A,{sx:{display:"flex",gap:.5},children:[(0,L.jsx)(w.A,{title:"Editar zona",children:(0,L.jsx)(q.A,{size:"small",onClick:()=>(e=>{ae(e);const r={nombre:e.nombre,descripcion:e.descripcion||"",activa:e.activa};oe(r),de("nombre",r.nombre),de("descripcion",r.descripcion),de("activa",r.activa),Q(!0)})(e),children:(0,L.jsx)(M.A,{})})}),(0,L.jsx)(w.A,{title:"Eliminar zona",children:(0,L.jsx)(q.A,{size:"small",color:"error",onClick:()=>(e=>{ae(e),re(!0)})(e),children:(0,L.jsx)(Y.A,{})})})]})})]},e.id)})})]})})}),(0,L.jsx)(je,{open:K,onClose:()=>U(!1),title:"Nueva Zona"}),(0,L.jsx)(je,{open:X,onClose:()=>Q(!1),title:"Editar Zona",isEdit:!0}),(0,L.jsxs)(n.A,{open:ee,onClose:()=>re(!1),children:[(0,L.jsx)(o.A,{children:"Confirmar Eliminaci\xf3n"}),(0,L.jsxs)(i.A,{children:[(0,L.jsxs)(d.A,{children:["\xbfEst\xe1s seguro de que deseas eliminar la zona"," ",(0,L.jsxs)("strong",{children:['"',null===se||void 0===se?void 0:se.nombre,'"']}),"?"]}),(null===Z||void 0===Z||null===(e=Z.personalPorZona)||void 0===e?void 0:e[null===se||void 0===se?void 0:se.nombre])&&(0,L.jsxs)(h.A,{severity:"warning",sx:{mt:2},children:["Esta zona tiene ",Z.personalPorZona[se.nombre]," persona(s) asociada(s)."]}),(0,L.jsx)(d.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Esta acci\xf3n no se puede deshacer."})]}),(0,L.jsxs)(u.A,{children:[(0,L.jsx)(m.A,{onClick:()=>re(!1),children:"Cancelar"}),(0,L.jsx)(m.A,{onClick:async()=>{try{const e=await B.A.deleteZona(se.id);e.success?(T(e.message),re(!1),me()):$(e.error)}catch(W){$("Error al eliminar zona")}},color:"error",variant:"contained",children:"Eliminar"})]})]})]})}}}]);
//# sourceMappingURL=248.53e50393.chunk.js.map