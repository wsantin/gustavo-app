"use strict";(self.webpackChunkpersonal_app=self.webpackChunkpersonal_app||[]).push([[61],{1061:(e,r,a)=>{a.r(r),a.d(r,{default:()=>P});var o=a(5043),s=a(9615),n=a(4858),t=a(8403),c=a(9806),i=a(3969),l=a(172),d=a(2097),u=a(5895),m=a(1449),h=a(1244),p=a(6128),g=a(3089),b=a(6154),x=a(9565),f=a(2579),j=a(4799),y=a(3023),v=a(1911),A=a(8776),E=a(5877),w=a(2950),z=a(8315),q=a(1773),N=a(8209),C=a(4111),L=a(1236),Z=a(3264),S=a(579);const P=function(){var e,r,a,P;const I=(0,s.Zp)(),{id:M}=(0,s.g)(),k=Boolean(M),[Y,G]=(0,o.useState)(!1),[D,O]=(0,o.useState)(k),[W,H]=(0,o.useState)([]),[T,J]=(0,o.useState)(""),[B,R]=(0,o.useState)(""),[U,$]=(0,o.useState)(!1),[F,V]=(0,o.useState)(""),[_,K]=(0,o.useState)(""),[X,Q]=(0,o.useState)(!1),[ee,re]=(0,o.useState)(null),{register:ae,handleSubmit:oe,formState:{errors:se},reset:ne,setValue:te}=(0,n.mN)({resolver:(0,t.t)(C.Hy),defaultValues:{dni:"",nombres:"",apellidos:"",celular:"",zona:""}});(0,o.useEffect)(()=>{(async()=>{if(re(null),console.log("\ud83d\udd04 Inicializando formulario..."),await ce(),k){const e=await Z.A.getZonas();if(e.success){const r=Array.isArray(e.data)?e.data:[];console.log("\ud83c\udfe2 Pasando zonas a loadSocio:",r.map(e=>e.nombre)),await ie(r)}else await ie([])}})()},[k,M]);const ce=async()=>{try{const e=await Z.A.getZonas();e.success?H(Array.isArray(e.data)?e.data:[]):H([])}catch(T){console.error("Error cargando datos iniciales:",T),J("Error al cargar las zonas"),H([])}},ie=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W;O(!0);try{console.log("\ud83d\udd0d Cargando datos del personal con ID:",M),console.log("\ud83c\udfe2 Zonas disponibles al momento de cargar:",e.map(e=>e.nombre));const r=await L.A.getSocioById(M);if(r.success){const a=r.data;console.log("\ud83d\udccb Datos del personal cargados:",a),te("dni",a.dni||""),te("nombres",a.nombres||""),te("apellidos",a.apellidos||""),te("celular",a.celular||"");const o=a.zona||"";if(console.log("\ud83c\udfe2 Zona a cargar:",o),te("zona",o),o&&e.length>0){const r=e.find(e=>e.nombre===o);console.log("\ud83c\udfe2 Zona encontrada para seleccionar:",r),re(r||null),r||console.warn("\u26a0\ufe0f No se encontr\xf3 la zona en la lista disponible")}else re(null),o&&console.warn("\u26a0\ufe0f Zona requerida pero lista de zonas vac\xeda");R("Datos del personal cargados correctamente")}else console.error("\u274c Error al cargar personal:",r.error),J("No se pudo cargar los datos del personal: "+r.error)}catch(T){console.error("\u274c Error al cargar personal:",T),J("Error al cargar los datos del personal")}finally{O(!1)}};return D?(0,S.jsx)(c.A,{maxWidth:"sm",children:(0,S.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,S.jsx)(l.A,{})})}):(0,S.jsxs)(c.A,{maxWidth:"md",children:[(0,S.jsxs)(i.A,{sx:{mb:3},children:[(0,S.jsx)(d.A,{startIcon:(0,S.jsx)(z.A,{}),onClick:()=>I("/personal"),sx:{mb:2},children:"Volver a la lista"}),(0,S.jsx)(u.A,{variant:"h4",gutterBottom:!0,children:k?"Editar Personal":"Nuevo Personal"}),(0,S.jsx)(u.A,{variant:"body1",color:"text.secondary",children:k?"Modifica los datos del personal":"Registra nuevo personal en el sistema"})]}),T&&(0,S.jsx)(m.A,{severity:"error",sx:{mb:3},onClose:()=>J(""),children:T}),B&&(0,S.jsx)(m.A,{severity:"success",sx:{mb:3},onClose:()=>R(""),children:B}),(0,S.jsx)(h.A,{children:(0,S.jsx)(p.A,{children:(0,S.jsx)("form",{onSubmit:oe(async e=>{G(!0),J(""),R("");try{let r;const a={dni:e.dni.trim(),nombres:e.nombres.trim(),apellidos:e.apellidos.trim(),celular:e.celular.trim(),zona:e.zona,estado:"activo",fechaRegistro:new Date};r=k?await L.A.updateSocio(M,a):await L.A.createSocio(a),r.success?(R(r.message),setTimeout(()=>{I("/personal")},1500)):J(r.error)}catch(T){console.error("Error al guardar personal:",T),J("Error inesperado al guardar los datos del personal")}finally{G(!1)}}),children:(0,S.jsxs)(g.A,{container:!0,spacing:3,children:[(0,S.jsx)(g.A,{item:!0,xs:12,md:6,children:(0,S.jsx)(b.A,{fullWidth:!0,label:"DNI *",placeholder:"Ej: 12345678",...ae("dni"),error:!!se.dni,helperText:null===(e=se.dni)||void 0===e?void 0:e.message,inputProps:{maxLength:8}})}),(0,S.jsx)(g.A,{item:!0,xs:12,md:6,children:(0,S.jsx)(b.A,{fullWidth:!0,label:"Celular *",placeholder:"Ej: 987654321",...ae("celular"),error:!!se.celular,helperText:null===(r=se.celular)||void 0===r?void 0:r.message,inputProps:{maxLength:9}})}),(0,S.jsx)(g.A,{item:!0,xs:12,md:6,children:(0,S.jsx)(b.A,{fullWidth:!0,label:"Nombres *",placeholder:"Ej: Juan Carlos",...ae("nombres"),error:!!se.nombres,helperText:null===(a=se.nombres)||void 0===a?void 0:a.message})}),(0,S.jsx)(g.A,{item:!0,xs:12,md:6,children:(0,S.jsx)(b.A,{fullWidth:!0,label:"Apellidos *",placeholder:"Ej: Garc\xeda L\xf3pez",...ae("apellidos"),error:!!se.apellidos,helperText:null===(P=se.apellidos)||void 0===P?void 0:P.message})}),(0,S.jsx)(g.A,{item:!0,xs:12,children:(0,S.jsxs)(i.A,{sx:{display:"flex",gap:1,alignItems:"flex-start",width:"100%"},children:[(0,S.jsx)(x.A,{sx:{flex:1,minWidth:200,maxWidth:250},fullWidth:!0,options:W,value:ee,getOptionLabel:e=>(null===e||void 0===e?void 0:e.nombre)||"",renderOption:(e,r)=>(0,S.jsx)(i.A,{component:"li",...e,children:(0,S.jsxs)(i.A,{children:[(0,S.jsx)(u.A,{variant:"body1",children:r.nombre}),r.descripcion&&(0,S.jsx)(u.A,{variant:"caption",color:"text.secondary",children:r.descripcion})]})}),renderInput:e=>{var r;return(0,S.jsx)(b.A,{...e,label:"Zona *",error:!!se.zona,helperText:null===(r=se.zona)||void 0===r?void 0:r.message,placeholder:"Buscar zona..."})},onChange:(e,r)=>{console.log("\ud83c\udfe2 Zona seleccionada:",r),re(r),te("zona",r?r.nombre:"")},noOptionsText:"No se encontraron zonas",isOptionEqualToValue:(e,r)=>e&&r?e.nombre===r.nombre:e===r}),(0,S.jsx)(f.A,{color:"primary",onClick:()=>$(!0),sx:{mt:1,bgcolor:"primary.light","&:hover":{bgcolor:"primary.main"},color:"white"},children:(0,S.jsx)(w.A,{})})]})}),(0,S.jsx)(g.A,{item:!0,xs:12,children:(0,S.jsxs)(i.A,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[(0,S.jsx)(d.A,{variant:"outlined",onClick:()=>I("/personal"),disabled:Y,children:"Cancelar"}),(0,S.jsx)(d.A,{type:"submit",variant:"contained",disabled:Y,startIcon:Y?(0,S.jsx)(l.A,{size:20}):k?(0,S.jsx)(q.A,{}):(0,S.jsx)(N.A,{}),children:Y?"Guardando...":k?"Actualizar Personal":"Registrar Personal"})]})})]})})})}),(0,S.jsxs)(j.A,{sx:{p:3,mt:3,bgcolor:"grey.50"},children:[(0,S.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"\u2139\ufe0f Informaci\xf3n Importante"}),(0,S.jsxs)(u.A,{variant:"body2",color:"text.secondary",children:["\u2022 El DNI debe tener exactamente 8 d\xedgitos",(0,S.jsx)("br",{}),"\u2022 El celular debe empezar con 9 y tener 9 d\xedgitos en total",(0,S.jsx)("br",{}),"\u2022 Los nombres y apellidos solo pueden contener letras y espacios",(0,S.jsx)("br",{}),"\u2022 Todos los campos marcados con (*) son obligatorios"]})]}),(0,S.jsxs)(y.A,{open:U,onClose:()=>{$(!1),V(""),K("")},maxWidth:"sm",fullWidth:!0,children:[(0,S.jsx)(v.A,{children:"Agregar Nueva Zona"}),(0,S.jsxs)(A.A,{children:[(0,S.jsx)(b.A,{fullWidth:!0,label:"Nombre de la Zona *",value:F,onChange:e=>V(e.target.value),margin:"normal",placeholder:"Ej: Zona Norte"}),(0,S.jsx)(b.A,{fullWidth:!0,label:"Descripci\xf3n (opcional)",value:_,onChange:e=>K(e.target.value),margin:"normal",multiline:!0,rows:2,placeholder:"Ej: Comprende los distritos del norte de la ciudad"})]}),(0,S.jsxs)(E.A,{children:[(0,S.jsx)(d.A,{onClick:()=>{$(!1),V(""),K("")},disabled:X,children:"Cancelar"}),(0,S.jsx)(d.A,{onClick:async()=>{if(F.trim()){Q(!0);try{const e={nombre:F.trim(),descripcion:_.trim(),activa:!0},r=await Z.A.createZona(e);if(r.success){await ce();const e={id:"temp-"+Date.now(),nombre:F.trim(),descripcion:_.trim(),activa:!0};re(e),te("zona",F.trim()),$(!1),V(""),K(""),R("Nueva zona agregada exitosamente")}else J(r.error||"Error al crear la zona")}catch(T){console.error("Error al crear zona:",T),J("Error inesperado al crear la zona")}finally{Q(!1)}}},variant:"contained",disabled:!F.trim()||X,startIcon:X?(0,S.jsx)(l.A,{size:20}):(0,S.jsx)(w.A,{}),children:X?"Guardando...":"Agregar Zona"})]})]})]})}},1236:(e,r,a)=>{a.d(r,{A:()=>n});var o=a(6667),s=a(6860);const n=new class{constructor(){this.collectionName="personal"}async createSocio(e){try{const r=s.j2.currentUser;if(!r)throw new Error("Usuario no autenticado");const a={...e,estado:e.estado||"activo",fechaRegistro:e.fechaRegistro||(0,o.O5)(),fechaCreacion:(0,o.O5)(),fechaModificacion:(0,o.O5)(),creadoPor:r.uid};return{success:!0,id:(await(0,o.gS)((0,o.rJ)(s.db,this.collectionName),a)).id,message:"Personal creado exitosamente"}}catch(r){return console.error("Error al crear socio:",r),{success:!1,error:this.getErrorMessage(r)}}}async getSocios(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const{pageSize:r=100,searchTerm:a="",zona:n="",campana:t="",estado:c=""}=e;console.log("\ud83d\udd0d Buscando personal con filtros:",{searchTerm:a,zona:n,campana:t,estado:c});let i=(0,o.rJ)(s.db,this.collectionName);i=(0,o.P)(i,(0,o.My)("fechaCreacion","desc"),(0,o.AB)(r));let l=(await(0,o.GG)(i)).docs.map(e=>({id:e.id,...e.data()}));if(console.log("\ud83d\udcca Total documentos obtenidos:",l.length),n&&""!==n?(l=l.filter(e=>e.zona===n),console.log("\ud83c\udfe2 Filtrados por zona:",l.length)):""===n&&console.log("\ud83c\udfe2 Mostrando todas las zonas"),t&&(l=l.filter(e=>e.campana===t),console.log("\ud83d\udce2 Filtrados por campa\xf1a:",l.length)),c&&(l=l.filter(e=>e.estado===c),console.log("\ud83d\udcca Filtrados por estado:",l.length)),a){const e=a.toLowerCase();l=l.filter(r=>(r.nombres||"").toLowerCase().includes(e)||(r.apellidos||"").toLowerCase().includes(e)||(r.celular||"").includes(e)||(r.dni||"").includes(e)),console.log("\ud83d\udd0d Filtrados por b\xfasqueda:",l.length)}return console.log("\u2705 Personal encontrado:",l.length),{success:!0,data:l,total:l.length}}catch(r){return console.error("\u274c Error al obtener personal:",r),{success:!1,error:this.getErrorMessage(r)}}}async getSocioById(e){try{const r=await(0,o.x7)((0,o.H9)(s.db,this.collectionName,e));return r.exists()?{success:!0,data:{id:r.id,...r.data()}}:{success:!1,error:"Personal no encontrado"}}catch(r){return console.error("Error al obtener personal:",r),{success:!1,error:this.getErrorMessage(r)}}}async updateSocio(e,r){try{const a=s.j2.currentUser;if(!a)throw new Error("Usuario no autenticado");const n={...r,fechaModificacion:(0,o.O5)(),modificadoPor:a.uid};return await(0,o.mZ)((0,o.H9)(s.db,this.collectionName,e),n),{success:!0,message:"Personal actualizado exitosamente"}}catch(a){return console.error("Error al actualizar personal:",a),{success:!1,error:this.getErrorMessage(a)}}}async deleteSocio(e){try{if(!s.j2.currentUser)throw new Error("Usuario no autenticado");return await(0,o.kd)((0,o.H9)(s.db,this.collectionName,e)),{success:!0,message:"Personal eliminado exitosamente"}}catch(r){return console.error("Error al eliminar personal:",r),{success:!1,error:this.getErrorMessage(r)}}}async getStats(){try{const e=(await(0,o.GG)((0,o.rJ)(s.db,this.collectionName))).docs.map(e=>e.data()),r=e.length,a=e.filter(e=>"activo"===e.estado).length,n=new Date;n.setDate(1),n.setHours(0,0,0,0);const t=e.filter(e=>{var r,a;return((null===(r=e.fechaCreacion)||void 0===r||null===(a=r.toDate)||void 0===a?void 0:a.call(r))||new Date(e.fechaCreacion))>=n}).length,c={};return e.forEach(e=>{e.zona&&(c[e.zona]=(c[e.zona]||0)+1)}),{success:!0,data:{total:r,activos:a,inactivos:r-a,nuevosMes:t,zonaStats:c}}}catch(e){return console.error("Error al obtener estad\xedsticas:",e),{success:!1,error:this.getErrorMessage(e)}}}async bulkDelete(e){try{const r=(0,o.wP)(s.db);return e.forEach(e=>{const a=(0,o.H9)(s.db,this.collectionName,e);r.delete(a)}),await r.commit(),{success:!0,message:`${e.length} socios eliminados exitosamente`}}catch(r){return console.error("Error en eliminaci\xf3n masiva:",r),{success:!1,error:this.getErrorMessage(r)}}}async updateEstado(e,r){return this.updateSocio(e,{estado:r})}getErrorMessage(e){const r={"permission-denied":"No tienes permisos para realizar esta operaci\xf3n","not-found":"El socio no fue encontrado",unavailable:"Servicio no disponible. Por favor, intenta m\xe1s tarde","failed-precondition":"Error en la operaci\xf3n. Verifica los datos","invalid-argument":"Datos inv\xe1lidos proporcionados"};return e.code&&r[e.code]?r[e.code]:e.message||"Ha ocurrido un error inesperado"}}},3264:(e,r,a)=>{a.d(r,{A:()=>n});var o=a(6667),s=a(6860);const n=new class{constructor(){this.collectionName="zonas"}async createZona(e){try{const r=s.j2.currentUser;if(!r)throw new Error("Usuario no autenticado");const a={...e,activa:void 0===e.activa||e.activa,fechaCreacion:(0,o.O5)(),fechaModificacion:(0,o.O5)(),creadoPor:r.uid},n=await(0,o.gS)((0,o.rJ)(s.db,this.collectionName),a);return{success:!0,id:n.id,data:{id:n.id,...a},message:"Zona creada exitosamente"}}catch(r){return{success:!1,error:r.message||"Error al crear zona"}}}async getZonas(){try{const e=(0,o.P)((0,o.rJ)(s.db,this.collectionName),(0,o.My)("nombre","asc")),r=await(0,o.GG)(e);return{success:!0,data:r.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas"}}}async getZonasActivas(){try{const e=(0,o.P)((0,o.rJ)(s.db,this.collectionName),(0,o._M)("activa","==",!0),(0,o.My)("nombre","asc")),r=await(0,o.GG)(e);return{success:!0,data:r.docs.map(e=>({id:e.id,...e.data()}))}}catch(e){return{success:!1,error:e.message||"Error al obtener zonas activas"}}}async updateZona(e,r){try{return await(0,o.mZ)((0,o.H9)(s.db,this.collectionName,e),{...r,fechaModificacion:(0,o.O5)()}),{success:!0,message:"Zona actualizada exitosamente"}}catch(a){return{success:!1,error:a.message||"Error al actualizar zona"}}}async getZonaById(e){try{const r=await(0,o.x7)((0,o.H9)(s.db,this.collectionName,e));return r.exists()?{success:!0,data:{id:r.id,...r.data()}}:{success:!1,error:"Zona no encontrada"}}catch(r){return{success:!1,error:r.message||"Error al obtener zona"}}}async deleteZona(e){try{const r=await(0,o.x7)((0,o.H9)(s.db,this.collectionName,e));if(!r.exists())return{success:!1,error:"Zona no encontrada"};const a=r.data().nombre,n=await(0,o.GG)((0,o.P)((0,o.rJ)(s.db,"personal"),(0,o._M)("zona","==",a)));return n.empty?(await(0,o.kd)((0,o.H9)(s.db,this.collectionName,e)),{success:!0,message:"Zona eliminada exitosamente"}):{success:!1,error:`No se puede eliminar la zona "${a}" porque tiene ${n.size} personal(es) asociado(s)`}}catch(r){return{success:!1,error:r.message||"Error al eliminar zona"}}}async getStats(){try{const e=await(0,o.GG)((0,o.rJ)(s.db,this.collectionName)),r=await(0,o.GG)((0,o.rJ)(s.db,"Personal")),a=e.docs.map(e=>({id:e.id,...e.data()})),n=r.docs.map(e=>e.data()),t=a.length,c=a.filter(e=>e.activa).length,i={};return n.forEach(e=>{e.zona&&(i[e.zona]=(i[e.zona]||0)+1)}),{success:!0,data:{total:t,activas:c,inactivas:t-c,personalPorZona:i}}}catch(e){return{success:!1,error:e.message||"Error al obtener estad\xedsticas"}}}}},4111:(e,r,a)=>{a.d(r,{Hy:()=>n,OI:()=>t,X5:()=>s});var o=a(899);const s=o.Ik({email:o.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido"),password:o.Yj().min(6,"La contrase\xf1a debe tener al menos 6 caracteres").required("La contrase\xf1a es requerida")}),n=(o.Ik({displayName:o.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(50,"El nombre no puede tener m\xe1s de 50 caracteres").required("El nombre es requerido"),email:o.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido"),password:o.Yj().min(6,"La contrase\xf1a debe tener al menos 6 caracteres").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"La contrase\xf1a debe contener al menos una may\xfascula, una min\xfascula y un n\xfamero").required("La contrase\xf1a es requerida"),confirmPassword:o.Yj().oneOf([o.KR("password"),null],"Las contrase\xf1as no coinciden").required("Confirme su contrase\xf1a")}),o.Ik({email:o.Yj().email("Correo electr\xf3nico inv\xe1lido").required("El correo electr\xf3nico es requerido")}),o.Ik({currentPassword:o.Yj().required("La contrase\xf1a actual es requerida"),newPassword:o.Yj().min(6,"La nueva contrase\xf1a debe tener al menos 6 caracteres").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"La contrase\xf1a debe contener al menos una may\xfascula, una min\xfascula y un n\xfamero").required("La nueva contrase\xf1a es requerida"),confirmNewPassword:o.Yj().oneOf([o.KR("newPassword"),null],"Las contrase\xf1as no coinciden").required("Confirme su nueva contrase\xf1a")}),o.Ik({dni:o.Yj().matches(/^\d{8}$/,"El DNI debe tener exactamente 8 d\xedgitos").required("El DNI es requerido"),nombres:o.Yj().min(2,"Los nombres deben tener al menos 2 caracteres").max(50,"Los nombres no pueden tener m\xe1s de 50 caracteres").matches(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/,"Los nombres solo pueden contener letras").required("Los nombres son requeridos"),apellidos:o.Yj().min(2,"Los apellidos deben tener al menos 2 caracteres").max(50,"Los apellidos no pueden tener m\xe1s de 50 caracteres").matches(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/,"Los apellidos solo pueden contener letras").required("Los apellidos son requeridos"),celular:o.Yj().matches(/^9\d{8}$/,"El celular debe empezar con 9 y tener 9 d\xedgitos").required("El celular es requerido"),zona:o.Yj().required("La zona es requerida")})),t=o.Ik({nombre:o.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(50,"El nombre no puede tener m\xe1s de 50 caracteres").required("El nombre es requerido"),descripcion:o.Yj().max(200,"La descripci\xf3n no puede tener m\xe1s de 200 caracteres").optional()});o.Ik({nombre:o.Yj().min(3,"El nombre debe tener al menos 3 caracteres").max(100,"El nombre no puede tener m\xe1s de 100 caracteres").required("El nombre es requerido"),descripcion:o.Yj().max(500,"La descripci\xf3n no puede tener m\xe1s de 500 caracteres").optional(),fechaInicio:o.p6().required("La fecha de inicio es requerida"),fechaFin:o.p6().min(o.KR("fechaInicio"),"La fecha de fin debe ser posterior a la de inicio").required("La fecha de fin es requerida"),activa:o.zM().required("El estado es requerido")})}}]);
//# sourceMappingURL=61.47226e46.chunk.js.map